<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Rotinas / Chamadas</title>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.0%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22512.000000pt%22%20height%3D%22512.000000pt%22%20viewBox%3D%220%200%20512.000000%20512.000000%22%20preserveAspectRatio%3D%22xMidYMid%20meet%22%3E%3Cg%20transform%3D%22translate(0.000000%2C512.000000)%20scale(0.100000%2C-0.100000)%22%20fill%3D%22white%22%20stroke%3D%22none%22%3E%3Cpath%20d%3D%22M825%205106%20c-41%20-18%20-83%20-69%20-90%20-109%20-3%20-18%20-4%20-1126%20-3%20-2464%20l3%20-2432%2021%20-27%20c11%20-15%2033%20-37%2048%20-48%20l27%20-21%201729%200%201729%200%2027%2021%20c15%2011%2037%2033%2048%2048%20l21%2027%200%202459%200%202459%20-21%2027%20c-11%2015%20-33%2037%20-48%2048%20-26%2020%20-41%2021%20-416%2024%20l-389%203%20-3%20-468%20c-3%20-450%20-4%20-469%20-23%20-495%20-46%20-62%2013%20-58%20-968%20-58%20l-894%200%20-34%2023%20c-70%2046%20-69%2040%20-69%20545%20l0%20452%20-332%200%20c-254%20-1%20-340%20-4%20-363%20-14z%20m1163%20-1785%20c49%20-26%2078%20-103%2061%20-165%20-9%20-33%20-42%20-72%20-177%20-208%20-91%20-92%20-180%20-174%20-198%20-183%20-80%20-38%20-134%20-13%20-270%20127%20-80%2081%20-104%20112%20-114%20146%20-20%2076%2018%20148%2094%20177%2060%2023%20113%208%20177%20-52%20l49%20-46%20109%20106%20c68%2066%20119%20108%20137%20112%2016%204%2034%208%2039%209%2015%204%2067%20-9%2093%20-23z%20m1718%20-287%20c54%20-26%2079%20-69%2079%20-136%200%20-66%20-22%20-103%20-76%20-130%20-31%20-17%20-81%20-18%20-597%20-18%20-616%200%20-604%20-1%20-655%2059%20-23%2027%20-27%2042%20-27%2091%200%2049%204%2064%2027%2091%2025%2059%2036%2058%20651%2059%20500%200%20568%20-2%20568%20-16z%20m-1719%20-544%20c61%20-37%2085%20-130%2050%20-195%20-8%20-16%20-91%20-105%20-184%20-197%20-181%20-179%20-197%20-189%20-280%20-173%20-54%2010%20-267%20221%20-282%20281%20-26%2098%2042%20186%20145%20186%2050%200%2091%20-22%20144%20-77%20l34%20-35%20106%20104%20c58%2057%20114%20108%20125%20114%2033%2018%20107%2014%20142%20-8z%20m1723%20-292%20c57%20-30%2083%20-76%2077%20-141%20-5%20-57%20-30%20-95%20-78%20-120%20-31%20-16%20-77%20-17%20-614%20-15%20-562%203%20-581%204%20-607%2023%20-45%2033%20-61%2074%20-56%20139%205%2064%2039%20110%2093%20125%2016%205%20280%2010%20585%2010%20l556%201%2044%20-22z%20m-1735%20-534%20c60%20-28%2092%20-101%2074%20-168%20-9%20-33%20-42%20-73%20-177%20-209%20-92%20-93%20-179%20-175%20-194%20-183%20-35%20-18%20-101%20-18%20-136%200%20-15%208%20-75%2063%20-133%20123%20-117%20118%20-138%20157%20-119%20222%2023%2082%2073%20116%20157%20109%2049%20-4%2059%20-9%20109%20-59%20l54%20-53%20108%20106%20c59%2058%20116%20110%20127%20116%2029%2016%2092%2014%20130%20-4z%20m1743%20-299%20c40%20-24%2072%20-81%2072%20-127%200%20-46%20-29%20-99%20-69%20-125%20l-34%20-23%20-574%200%20c-638%200%20-622%20-2%20-664%2066%20-26%2043%20-27%20113%20-2%20157%2010%2018%2038%2042%2055%2063%2055%20l45%2023%20565%20-3%20c545%20-3%205566%20-4%20598%20-23z%22%2F%3E%3Cpath%20d%3D%22M1820%204760%20l0%20-360%20695%200%20695%200%200%20360%200%20360%20-695%200%20-695%200%200%20-360z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E">

    <style>
        .login-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            width: 320px;
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        .login-button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .login-button:hover {
            background-color: #0056b3;
        }

        .login-footer {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .login-footer a {
            color: #007bff;
            text-decoration: none;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 20px;
        }

        /* Bot√µes superiores */
        div>button {
            color: white;
            border: none;
            padding: 10px 16px;
            margin-right: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        /* Filtros */
        #filtro,
        #filtro_chamadas,
        #resumo_chamadas,
        #filtro_equipes,
        #filtro_setores {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #resumo_chamadas table {
            width: 100%;
            table-layout: fixed;
            /* üëà for√ßa as colunas a se distribu√≠rem igualmente */
            border-collapse: collapse;
            text-align: center;
        }

        #filtro table td,
        #filtro_chamadas table td,
        #resumo_chamadas table td,
        #filtro_equipes table td,
        #filtro_setores table td {
            padding: 10px;
        }


        #seleciona_periodo_absoluto,
        #seleciona_periodo_relativo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #seleciona_periodo_absoluto:hover,
        #seleciona_periodo_relativo:hover {
            background-color: #f0f0f0;
        }

        #seleciona_periodo_absoluto input[type="radio"],
        #seleciona_periodo_relativo input[type="radio"] {
            cursor: pointer;
        }

        #seleciona_periodo_absoluto div,
        #seleciona_periodo_relativo div {
            display: flex;
            gap: 10px;
        }

        #seleciona_periodo_absoluto input[type="datetime-local"],
        #seleciona_periodo_relativo input,
        #seleciona_periodo_relativo select,
        #num_pregistros_rotinas {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            cursor: pointer;
        }

        #num_periodo_relativo,
        #num_pregistros_rotinas {
            width: 35px;
        }

        #filtro input[type*="date"],
        #filtro_chamadas input[type*="date"],
        #filtro_equipes input[type*="date"],
        #filtro button,
        #filtro_equipes button,
        #filtro_chamadas button {
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #filtro button,
        #filtro_chamadas button,
        #filtro_equipes button {
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s, color 0.32;
            color: black;
        }

        #filtro button:hover,
        #filtro_equipes button:hover,
        #filtro_chamadas button:hover {
            background-color: #ffffff;
        }

        #filtro_chamadas div {
            display: flex;
            flex-direction: row;
            margin-left: auto;
            align-items: center;
            text-align: center;
        }

        #filtro input[type="checkbox"] {
            margin-right: 5px;
        }

        #filtro input[readonly],
        #filtro select[readonly] {
            background-color: #ebe9e9;
            /* cor de fundo t√≠pica de disabled */
            color: #b4b4b4;
            /* cursor padr√£o de disabled */
            pointer-events: none;
        }

        /* Tabela de rotinas */
        #rotinas_table,
        #chamadas_table,
        #setores_table,
        #equipes_table,
        #usu√°rios_table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px;
            margin-top: 4px;
            min-width: 160px;
            z-index: 999;
        }

        .dropdown-content label {
            display: block;
            margin-bottom: 4px;
        }

        .dropdown.show .dropdown-content {
            display: block;
        }

        body:not(.dark-mode) .div_tabela_registros::-webkit-scrollbar,
        body:not(.dark-mode).modal-content::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        body:not(.dark-mode) .div_tabela_registros::-webkit-scrollbar-track,
        body:not(.dark-mode).modal-content::-webkit-scrollbar-track {
            background: #b1b1b146;
        }

        body:not(.dark-mode) .div_tabela_registros::-webkit-scrollbar-thumb,
        body:not(.dark-mode).modal-content::-webkit-scrollbar-thumb {
            background-color: #f0f0f0;
            border-radius: 10px;
            border: 2px solid #f0f0f0;
        }

        body:not(.dark-mode) .div_tabela_registros::-webkit-scrollbar-thumb:hover,
        body:not(.dark-mode).modal-content::-webkit-scrollbar-thumb:hover {
            background-color: #666;
        }

        /* Fundo escuro semi-transparente */
        .modal {
            display: none;
            /* Escondido por padr√£o */
            position: fixed;
            /* Fica sobre toda a tela */
            z-index: 1000;
            /* Sobre outros elementos */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;

            /* Scroll se o conte√∫do for grande */
            background-color: rgba(0, 0, 0, 0.5);
            /* Fundo semi-transparente */
        }

        /* Caixa do conte√∫do */
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            /* 10% do topo, centralizado horizontalmente */
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            /* Largura do modal */
            max-width: 80%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            overflow: auto;
            max-height: 60%;
        }

        /* Bot√£o de fechar (X) */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
        }

        /* Container de bot√µes no rodap√© */
        .botoes_rodape {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Bot√£o Cancelar */
        .botoes_rodape_cancelar {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }

        .botoes_rodape_cancelar:hover {
            background-color: #e0e0e0;
        }

        /* Bot√£o Confirmar */
        .botoes_rodape_confirmar {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .botoes_rodape_confirmar:hover {
            background-color: #0056b3;
        }

        details {
            background: #fff;
            border: 1.5px solid #ccc;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: box-shadow 0.3s ease;
            cursor: pointer;
        }

        details[open] {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        summary {
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            outline: none;
            position: relative;
            padding-left: 28px;
            user-select: none;
            list-style: none;
        }

        /* Custom arrow */
        summary::before {
            content: "‚ñ∂";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
            color: #0078d4;
        }

        details[open]>summary::before {
            transform: translateY(-50%) rotate(90deg);
        }

        body:not(.dark-mode) #rotinas_table,
        body:not(.dark-mode) #chamadas_table,
        body:not(.dark-mode) #setores_table,
        body:not(.dark-mode) #equipes_table,
        body:not(.dark-mode) #usu√°rios_table {
            background: white;
        }

        body:not(.dark-mode) #rotinas_table tr:nth-child(even),
        body:not(.dark-mode) #chamadas_table tr:nth-child(even),
        body:not(.dark-mode) #setores_table tr:nth-child(even),
        body:not(.dark-mode) #equipes_table tr:nth-child(even),
        body:not(.dark-mode) #usu√°rios_table tr:nth-child(even) {
            background-color: #fffafa;
        }

        body:not(.dark-mode) #rotinas_table tr:hover,
        body:not(.dark-mode) #chamadas_table tr:hover,
        body:not(.dark-mode) #setores_table tr:hover,
        body:not(.dark-mode) #equipes_table tr:hover,
        body:not(.dark-mode) #usu√°rios_table tr:hover {
            background-color: #eceaea;
        }

        #rotinas_table th,
        #rotinas_table td,
        #chamadas_table th,
        #chamadas_table td,
        #setores_table th,
        #setores_table td,
        #equipes_table th,
        #equipes_table td,
        #usu√°rios_table th,
        #usu√°rios_table td {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }

        body:not(.dark-mode) #rotinas_table th,
        body:not(.dark-mode) #chamadas_table th,
        body:not(.dark-mode) #setores_table th,
        body:not(.dark-mode) #equipes_table th,
        body:not(.dark-mode) #usu√°rios_table th {
            position: sticky;
            top: 0;
            z-index: 2;
            border-top: 5px;
            /* ou maior se tiver sombras */
            background-color: #f0f0f0;
            font-weight: bold;

        }

        body.dark-mode #rotinas_table th,
        body.dark-mode #chamadas_table th,
        body.dark-mode #setores_table th,
        body.dark-mode #equipes_table th,
        body.dark-mode #usu√°rios_table th {
            position: sticky;
            top: 0;
            z-index: 2;
            border-top: 5px;
            /* ou maior se tiver sombras */
            font-weight: bold;

        }

        body:not(.dark-mode) #rotinas_table td[contenteditable="true"]:focus,
        body:not(.dark-mode) #chamadas_table td[contenteditable="true"]:focus,
        body:not(.dark-mode) #setores_table td[contenteditable="true"]:focus,
        body:not(.dark-mode) #usu√°rios_table td[contenteditable="true"]:focus {
            background-color: #ffffcc;
            outline: 2px solid #ffc107;
        }

        th.sortable {
            cursor: pointer;
            position: relative;
            padding-right: 20px;
        }

        th.sortable::after {
            content: '‚áÖ';
            font-size: 0.8em;
            position: absolute;
            right: 8px;
            color: #999;
        }

        th.sortable:hover::after {
            color: #333;
        }

        th.sorted-asc::after {
            content: '‚Üë';
            color: #000;
        }

        th.sorted-desc::after {
            content: '‚Üì';
            color: #000;
        }

        th.sortable:hover::after {
            color: #d4d4d4;
        }

        th.sorted-asc::after {
            content: '‚Üë';
            color: #d4d4d4;
        }

        th.sorted-desc::after {
            content: '‚Üì';
            color: #d4d4d4;
        }

        #options-list {
            display: none;
            position: absolute;
            border: 1px solid #ccc;
            background: #fff;
            list-style: none;
            margin: 0;
            padding: 0;
            max-height: 150px;
            overflow-y: auto
        }


        body.dark-mode #options-list {
            border: 1px solid #ccc;
            background: #000;
        }

        .selecionado {
            background-color: rgb(224, 223, 223);
        }

        body.dark-mode .selecionado {
            background-color: rgb(43, 42, 42);
        }

        #options-list li:hover {
            background-color: rgb(194, 194, 194);
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ccc;
            margin-bottom: 10px;
        }

        .tab-button {
            background-color: #f4f4f4;
            border: none;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            padding: 10px 16px;
            margin-right: 4px;
            cursor: pointer;
            font-weight: bold;
            border: 1px solid #ccc;
            border-bottom: none;
            transition: background-color 0.3s, color 0.3s;
            color: black;
        }

        .tab-button:hover {
            background-color: #e0e0e0;
        }

        .tab-button.ativo {
            background-color: white;
            color: #007bff;
            border-bottom: 2px solid white;
        }

        svg:hover {
            cursor: pointer;
        }

        body.dark-mode svg.copiar {
            stroke: white;
        }

        .copiar:hover path,
        .copiar:hover rect,
        .copiar_clicado:hover path,
        .copiar_clicado:hover rect {
            fill: #ffc107;
        }

        .copiar_clicado path,
        .copiar_clicado rect {
            fill: #21e232;
        }

        body.dark-mode .copiar_clicado path,
        body.dark-mode .copiar_clicado rect {
            fill: #21e232;
            stroke: white
        }

        .borracha:hover path,
        body.dark-mode .borracha:hover path {
            fill: red;
        }

        body.dark-mode .borracha path {
            fill: white;
        }

        body.dark-mode .empenhar path {
            fill: rgb(248, 248, 248);
        }

        .empenhar:hover path {
            fill: rgb(33, 16, 133) !important;
        }

        .copiado-msg {
            position: absolute;
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            animation: fadeOut 2s forwards;
            top: -30px;
            left: 90%;
            transform: translateX(-50%);
            pointer-events: none;
            opacity: 0;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background-color: #fff;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        input[type="text"]:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
        }

        /* Esconde o checkbox nativo */
        .custom-checkbox {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* Container */
        .checkbox-wrapper {
            display: inline-block;
            position: relative;
            cursor: pointer;
            user-select: none;
        }

        /* Caixa customizada */
        .checkmark {
            margin-top: 2px;
            display: inline-block;
            width: 13px;
            height: 13px;
            border: 2px solid #4d4c4c;
            /* ‚Üê Aqui voc√™ controla a grossura */
            border-radius: 3px;
            box-sizing: border-box;
            position: relative;
            background-color: white;
        }

        /* Check (‚úì) mais grosso */
        .custom-checkbox:checked+.checkmark::after {
            content: "";
            position: absolute;
            left: 2px;
            top: -1px;
            width: 3px;
            height: 7px;
            border: solid #ffffff;
            border-width: 0 2px 2px 0;
            /* ‚Üê Tra√ßo do check */
            transform: rotate(45deg);
        }

        .custom-checkbox:checked+.checkmark {
            background-color: #007bff;
            /* azul */
            border-color: #007bff;
        }

        .div_tabela_registros {
            max-height: 70vh;
            overflow: auto;
        }

        #chamadas .div_tabela_registros {
            max-height: 62vh;
        }

        body.dark-mode {
            background-color: #181818;
            color: #e0e0e0;
        }

        /* Bot√µes superiores */
        body.dark-mode div>button {
            background-color: #1f6feb;
            color: white;
        }

        body.dark-mode div>button:hover {
            background-color: #104bb3;
        }

        /* Filtros */
        body.dark-mode #filtro,
        body.dark-mode #filtro_chamadas,
        body.dark-mode #filtro_equipes,
        body.dark-mode #resumo_chamadas,
        body.dark-mode #filtro_setores {
            background: #2c2c2c;
            box-shadow: none;
        }

        body.dark-mode #filtro input[type*="date"],
        body.dark-mode #filtro_chamadas input[type*="date"],
        body.dark-mode #filtro_equipes input[type*="date"],
        body.dark-mode #filtro button,
        body.dark-mode #filtro_chamadas button,
        body.dark-mode #filtro_equipes button,
        body.dark-mode #seleciona_periodo_absoluto,
        body.dark-mode #seleciona_periodo_relativo,
        body.dark-mode #seleciona_periodo_relativo input,
        body.dark-mode #seleciona_periodo_relativo select,
        body.dark-mode #num_pregistros_rotinas {
            background-color: #1e1e1e;
            color: #fff;
            border: 1px solid #555;
        }

        body.dark-mode #filtro input[readonly],
        body.dark-mode #filtro select[readonly] {
            background-color: #363636;
            /* cor de fundo t√≠pica de disabled */
            color: #504f4f;
            /* cursor padr√£o de disabled */
            pointer-events: none;
        }

        body.dark-mode #filtro button:hover,
        body.dark-mode #filtro_chamadas button:hover,
        body.dark-mode #filtro_equipes button:hover {
            background-color: #333;
        }

        /* Tabelas */
        body.dark-mode table {
            background: #252525;
            color: #ddd;
            border-color: #444;
        }

        body.dark-mode table td,
        body.dark-mode table th {
            border-color: #444;
        }

        body.dark-mode tr:nth-child(even) {
            background-color: #1f1f1f;
        }

        body.dark-mode tr:hover {
            background-color: #333;
        }

        body.dark-mode th {
            background-color: #2c2c2c;
            color: #fff;
        }

        body.dark-mode .dropdown-content {
            background: #2c2c2c;
            border: 1px solid #444;
        }

        body.dark-mode .div_tabela_registros::-webkit-scrollbar,
        body.dark-mode .modal-content::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        body.dark-mode .div_tabela_registros::-webkit-scrollbar-track,
        body.dark-mode .modal-content::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        body.dark-mode .div_tabela_registros::-webkit-scrollbar-thumb,
        body.dark-mode .modal-content::-webkit-scrollbar-thumb {
            background-color: #444;
            border-radius: 10px;
            border: 2px solid #1a1a1a;
        }

        body.dark-mode .div_tabela_registros::-webkit-scrollbar-thumb:hover,
        body.dark-mode .modal-content::-webkit-scrollbar-thumb:hover {
            background-color: #666;
        }



        /* Tabs */
        body.dark-mode .tab-button {
            background-color: #222;
            color: #ccc;
            border-color: #444;
        }

        body.dark-mode .tab-button:hover {
            background-color: #2d2d2d;
        }

        body.dark-mode .tab-button.ativo {
            background-color: #333;
            color: #4ea5ff;
            border-color: #444;
        }

        /* Inputs */
        body.dark-mode input[type="text"] {
            background-color: #1e1e1e;
            color: #fff;
            border: 1px solid #555;
        }

        body.dark-mode input[type="text"]:focus {
            border-color: #4ea5ff;
            box-shadow: 0 0 0 3px rgba(78, 165, 255, 0.3);
        }

        /* Checkbox customizado */
        body.dark-mode .checkmark {
            border-color: #888;
            background-color: #1a1a1a;
        }

        body.dark-mode .custom-checkbox:checked+.checkmark {
            background-color: #4ea5ff;
            border-color: #4ea5ff;
        }

        /* Copiado msg */
        body.dark-mode .copiado-msg {
            background-color: #4ea5ff;
        }

        /* SVGs (√≠cones) */
        body.dark-mode svg:hover path,
        body.dark-mode svg:hover rect {
            fill: #ffc107;
        }

        /* Selecao e hover */
        body.dark-mode .selecionado {
            background-color: #303030;
        }

        body.dark-mode #options-list li:hover {
            background-color: #3a3a3a;
        }

        body.dark-mode .login-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2c2c2c;
            color: #e0e0e0;
            box-shadow: none;
        }

        body.dark-mode .login-container h2,
        body.dark-mode .form-group label {
            color: #e0e0e0;
        }

        body.dark-mode .form-group input {
            background-color: #1e1e1e;
            color: #fff;
            border: 1px solid #555;
        }

        body.dark-mode .form-group input:focus {
            border-color: #4ea5ff;
            box-shadow: 0 0 0 3px rgba(78, 165, 255, 0.3);
        }

        body.dark-mode .login-button {
            background-color: #1f6feb;
            color: white;
        }

        body.dark-mode .login-button:hover {
            background-color: #104bb3;
        }

        body.dark-mode .login-footer {
            color: #aaa;
        }

        body.dark-mode .login-footer a {
            color: #4ea5ff;
        }

        body.dark-mode .login-footer a:hover {
            color: #73b4ff;
        }

        #toggle-dark-mode {
            background-color: #00000000;
            position: fixed;
            right: 15px;
            border: 0;
            font-size: 20px;
            border-radius: 50%;
            padding: 5px
        }

        #toggle-dark-mode:hover {
            cursor: pointer;
            background-color: #6e6e6e7e;
        }

        #logout {
            background-color: #00000000;
            position: fixed;
            right: 55px;
            margin-top: 5px;
            border: 0;
            font-size: 20px;
            color: #d80909;
            border-radius: 50%;
            padding: 5px
        }

        #logout:hover {
            cursor: pointer;
            background-color: #6e6e6e7e;
        }



        /* Caixa do conte√∫do */
        body.dark-mode .modal-content {
            background-color: #252525;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode details {
            background: #1e1e1e;
            border: 1, 5px solid #555;
        }

        details[open] {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .selection-box {
            position: absolute;
            border: 2px #007bff;
            background: rgba(0, 123, 255, 0.2);
            pointer-events: none;
        }

        .selected {
            background: #007bff;
        }
    </style>
</head>

<body>
    <div id="login">
        <div class="login-container">
            <h2>Rotinas</h2>
            <span id="tela_aviso"></span>
            <div class="form-group">
                <label for="usuario">Usu√°rio</label>
                <input type="text" id="usuario" name="usuario" required>
            </div>
            <div class="form-group">
                <label for="senha">Senha</label>
                <input onkeydown="teclas_atalho('senha',event.key)" type="password" id="senha" name="senha" required>
            </div>
            <button onclick="login()" class="login-button">Entrar</button>
            <div class="login-footer">
            </div>
        </div>
    </div>
    <div id="primeiro_acesso" style="display: none;">
        <div class="login-container">
            <h2>Primeiro Acesso</h2>
            <span id="tela_aviso_primeiro_acesso">Por favor, altere sua senha</span>
            <div class="form-group">
                <label for="senha">Senha</label>
                <input type="password" id="senha_primeiro_acesso" name="senha" required>
            </div>
            <div class="form-group">
                <label for="senha">Repetir Senha</label>
                <input onkeydown="teclas_atalho('primeiro_acesso',event.key)" type="password"
                    id="repetir_senha_primeiro_acesso" name="senha" required>
            </div>
            <button onclick="primeiro_acesso()" class="login-button">Alterar</button>
            <div class="login-footer">
            </div>
        </div>
    </div>
    <div id="programa" style="display: none;">
        <div onclick="logout()" id="logout">X</div>
        <div id="toggle-dark-mode">üåô</div>
        <div class="tabs">
            <button class="tab-button ativo" onclick="selecionarAba(this)">Rotinas</button>
            <button class="tab-button" onclick="selecionarAba(this)">Chamadas</button>
            <button class="tab-button" onclick="selecionarAba(this)">Equipes</button>
            <button class="tab-button" onclick="selecionarAba(this)">Setores</button>
            <button style="display: none;" id="aba_usu√°rios" class="tab-button"
                onclick="selecionarAba(this)">Usu√°rios</button>
        </div>
        <br><br>
        <div id="rotinas">
            <div id="filtro">
                <table>
                    <tbody>
                        <tr>
                            <td>
                                <button onclick="turno_atual(this)">Turno Atual</button>
                            </td>
                            <td>
                                <div id="seleciona_periodo_absoluto" onclick="this.querySelector('input').click()">
                                    <input type="radio" name="seleciona_tipo_periodo" checked
                                        oninput="seleciona_periodo(this)">
                                    <div>
                                        <input oninput="filtrar_dados('rotinas')" type="datetime-local"
                                            name="rotina_data_inicial" id="rotina_data_inicial">
                                        <input oninput="filtrar_dados('rotinas')" type="datetime-local"
                                            name="rotina_data_final" id="rotina_data_final">
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div id="seleciona_periodo_relativo" onclick="this.querySelector('input').click()">
                                    <input type="radio" name="seleciona_tipo_periodo" oninput="seleciona_periodo(this)">
                                    <div>
                                        <input type="number" id="num_periodo_relativo"
                                            oninput="filtrar_dados('rotinas')" readonly value="1">
                                        <select readonly name="select_tipo_periodo" onchange="filtrar_dados('rotinas')"
                                            id="select_tipo_periodo">
                                            <option value="1">√öltimo(s) Minuto(s)</option>
                                            <option selected value="60">√öltima(s) Hora(s)</option>
                                            <option value="1440">√öltimo(s) Dia(s)</option>
                                        </select>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <input oninput="filtrar_dados('rotinas')" type="checkbox" name="rotina_checkbox_norte"
                                    id="rotina_checkbox_norte">
                                <label for="rotina_checkbox_norte">NORTE</label>
                            </td>
                            <td>
                                <input oninput="filtrar_dados('rotinas')" type="checkbox" name="rotina_checkbox_sul"
                                    id="rotina_checkbox_sul">
                                <label for="rotina_checkbox_sul">SUL</label>
                            </td>
                            <td>
                                <input oninput="filtrar_dados('rotinas')" type="checkbox" name="rotina_checkbox_centro"
                                    id="rotina_checkbox_centro">
                                <label for="rotina_checkbox_centro">CENTRO</label>
                            </td>
                            <td>
                                <input oninput="filtrar_dados('rotinas')" type="checkbox"
                                    name="rotina_checkbox_especializadas" id="rotina_checkbox_especializadas">
                                <label for="rotina_checkbox_especializadas">OUTRAS</label>
                            </td>
                            <td>
                                <button onclick="abrir_filtro_avancado(this)">‚Üê</button>
                            </td>
                        </tr>
                        <tr style="display: none;">
                            <td>

                            </td>
                            <td>
                                <span>
                                    <input type="number" id="num_pregistros_rotinas"
                                        oninput="ultimos_registros('rotinas')" value="20">
                                    √öltimo(s) Reg. por QRA
                                </span>
                            </td>
                            <td>

                            </td>
                            <td>

                            </td>
                            <td>

                            </td>
                            <td>

                            </td>
                            <td>

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="div_tabela_registros">
                <table id="rotinas_table">
                    <thead>
                        <tr>
                            <th class="no-sort">
                                <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                                    <label class="checkbox-wrapper">
                                        <input type="checkbox" class="custom-checkbox" onchange="selecionar_tudo(this)">
                                        <span class="checkmark"></span>
                                    </label>
                                    <svg class="copiar" onclick="copiar_selecionados()"
                                        xmlns="http://www.w3.org/2000/svg" height="15px" viewBox="0 0 24 24" fill="none"
                                        stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                    </svg>
                                    <svg class="borracha" onclick="excluir_selecionados()"
                                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                        width="17px" height="17px" viewBox="0 0 15 15" version="1.1">
                                        <g>
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 3.28125 12.65625 L 14.0625 12.65625 L 14.0625 13.59375 L 3.28125 13.59375 Z M 3.28125 12.65625 " />
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 12.835938 4.925781 L 9.117188 1.214844 C 8.941406 1.039062 8.703125 0.9375 8.453125 0.9375 C 8.207031 0.9375 7.964844 1.039062 7.789062 1.214844 L 1.226562 7.777344 C 1.050781 7.953125 0.953125 8.191406 0.953125 8.441406 C 0.953125 8.6875 1.050781 8.925781 1.226562 9.101562 L 3.34375 11.25 L 7.835938 11.25 L 12.835938 6.253906 C 13.011719 6.078125 13.109375 5.839844 13.109375 5.589844 C 13.109375 5.339844 13.011719 5.101562 12.835938 4.925781 Z M 7.449219 10.3125 L 3.75 10.3125 L 1.875 8.4375 L 4.832031 5.480469 L 8.550781 9.191406 Z M 9.210938 8.550781 L 5.5 4.832031 L 8.4375 1.875 L 12.1875 5.59375 Z M 9.210938 8.550781 " />
                                        </g>
                                    </svg>
                                </span>
                            </th>
                            <th class="sortable">QRA</th>
                            <th class="sortable">QRU</th>
                            <th class="sortable">QTH</th>
                            <th class="sortable">ENDERE√áO</th>
                            <th class="sortable">QTR INICIAL</th>
                            <th class="sortable">QTR FINAL</th>
                            <th class="sortable">OBS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="width: 10px; white-space: nowrap;">
                                <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                                    <label class="checkbox-wrapper">
                                        <input type="checkbox" class="custom-checkbox">
                                        <span class="checkmark"></span>
                                    </label>
                                    <svg class="copiar" onclick="copiar_dados(this,false)"
                                        xmlns="http://www.w3.org/2000/svg" height="15px" viewBox="0 0 24 24" fill="none"
                                        stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                    </svg>
                                    <svg class="borracha" onclick="excluir_linha(this,false)"
                                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                        width="17px" height="17px" viewBox="0 0 15 15" version="1.1">
                                        <g>
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 3.28125 12.65625 L 14.0625 12.65625 L 14.0625 13.59375 L 3.28125 13.59375 Z M 3.28125 12.65625 " />
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 12.835938 4.925781 L 9.117188 1.214844 C 8.941406 1.039062 8.703125 0.9375 8.453125 0.9375 C 8.207031 0.9375 7.964844 1.039062 7.789062 1.214844 L 1.226562 7.777344 C 1.050781 7.953125 0.953125 8.191406 0.953125 8.441406 C 0.953125 8.6875 1.050781 8.925781 1.226562 9.101562 L 3.34375 11.25 L 7.835938 11.25 L 12.835938 6.253906 C 13.011719 6.078125 13.109375 5.839844 13.109375 5.589844 C 13.109375 5.339844 13.011719 5.101562 12.835938 4.925781 Z M 7.449219 10.3125 L 3.75 10.3125 L 1.875 8.4375 L 4.832031 5.480469 L 8.550781 9.191406 Z M 9.210938 8.550781 L 5.5 4.832031 L 8.4375 1.875 L 12.1875 5.59375 Z M 9.210938 8.550781 " />
                                        </g>
                                    </svg>
                                </span>
                            </td>

                            <td oninput="filterOptions(this,0)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,1)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,2)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,3)" onfocus="horario_final(this)" contenteditable="true"
                                onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div id="chamadas" style="display: none;">
            <div id="filtro_chamadas" style="display: flex;">
                <table>
                    <tbody>

                        <tr>
                            <td>
                                <button onclick="turno_atual(this)">Turno Atual</button>
                            </td>
                            <td>
                                <input oninput="filtrar_dados('chamadas')" type="datetime-local"
                                    name="chamadas_data_inicial" id="chamadas_data_inicial">
                            </td>
                            <td>
                                <input oninput="filtrar_dados('chamadas')" type="datetime-local"
                                    name="chamadas_data_final" id="chamadas_data_final">
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div>
                    <button id="legislacao_button" onclick="abrir_legislacao_modal()">Legisla√ß√£o Aplicada</button>
                </div>
            </div>
            <div id="resumo_chamadas">
                <table>
                    <thead>
                        <tr>
                            <th>Den√∫ncias 153</th>
                            <th>Den√∫ncias WhatsApp</th>
                            <th>Total de Liga√ß√µes</th>
                            <th>Apoio ao Samu</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="div_tabela_registros">
                <table id="chamadas_table">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="sortable">NOME</th>
                            <th class="sortable">TELEFONE</th>
                            <th class="sortable">NARRATIVA</th>
                            <th class="sortable">NATUREZA</th>
                            <th class="sortable">ENDERE√áO</th>
                            <th class="sortable">ATENDENTE</th>
                            <th class="sortable">√ÅREA</th>
                            <th class="sortable">MEIO</th>
                            <th class="sortable">QTR</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="width: 10px;">
                                <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                                    <svg class="copiar" onclick="copiar_dados(this,false)"
                                        xmlns="http://www.w3.org/2000/svg" height="18px" width="18px"
                                        viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                    </svg>

                                    <svg class="empenhar" onclick="empenhar_gu(this)" xmlns="http://www.w3.org/2000/svg"
                                        xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px"
                                        viewBox="0 0 20 20" version="1.1">
                                        <g id="surface1">
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 4.765625 1.308594 C 4.167969 1.441406 3.535156 1.882812 3.210938 2.394531 C 3.003906 2.71875 2.96875 2.832031 2.1875 5.4375 L 1.511719 7.691406 L 1.253906 7.839844 C 0.738281 8.136719 0.289062 8.699219 0.105469 9.277344 C 0.0195312 9.550781 0.0195312 9.5625 0.0195312 12.441406 L 0.0195312 15.332031 L 0.109375 15.507812 C 0.15625 15.605469 0.246094 15.75 0.308594 15.824219 C 0.453125 15.996094 0.820312 16.195312 1.0625 16.230469 L 1.242188 16.257812 L 1.257812 17.046875 C 1.269531 17.761719 1.277344 17.847656 1.359375 18.007812 C 1.496094 18.285156 1.652344 18.453125 1.921875 18.597656 L 2.167969 18.730469 L 4.082031 18.730469 L 4.328125 18.597656 C 4.601562 18.449219 4.71875 18.328125 4.875 18.03125 C 4.976562 17.835938 4.980469 17.808594 4.992188 17.039062 L 5.007812 16.25 L 15 16.25 L 15 16.96875 C 15 17.523438 15.015625 17.730469 15.0625 17.882812 C 15.160156 18.179688 15.371094 18.429688 15.664062 18.589844 L 15.917969 18.730469 L 17.832031 18.730469 L 18.078125 18.597656 C 18.351562 18.449219 18.46875 18.328125 18.625 18.03125 C 18.726562 17.835938 18.730469 17.808594 18.742188 17.046875 L 18.757812 16.257812 L 18.9375 16.230469 C 19.167969 16.195312 19.542969 16 19.671875 15.847656 C 19.726562 15.785156 19.816406 15.640625 19.875 15.53125 L 19.980469 15.332031 L 19.980469 12.441406 C 19.980469 9.5625 19.980469 9.550781 19.894531 9.277344 C 19.710938 8.699219 19.261719 8.136719 18.746094 7.839844 L 18.488281 7.691406 L 17.8125 5.4375 C 17.441406 4.199219 17.09375 3.058594 17.039062 2.910156 C 16.785156 2.191406 16.222656 1.640625 15.484375 1.378906 L 15.175781 1.269531 L 10.097656 1.261719 C 5.859375 1.257812 4.976562 1.265625 4.765625 1.308594 Z M 15.257812 5.625 C 15.566406 6.644531 15.816406 7.484375 15.820312 7.488281 C 15.820312 7.496094 13.199219 7.5 9.996094 7.5 C 5.199219 7.5 4.175781 7.492188 4.191406 7.449219 C 4.203125 7.421875 4.453125 6.589844 4.746094 5.601562 C 5.042969 4.617188 5.292969 3.796875 5.300781 3.777344 C 5.308594 3.761719 7.429688 3.753906 10.007812 3.757812 L 14.699219 3.769531 Z M 5.511719 10.738281 C 5.78125 10.867188 5.949219 11.027344 6.097656 11.296875 C 6.21875 11.523438 6.230469 11.570312 6.230469 11.875 C 6.230469 12.179688 6.21875 12.226562 6.097656 12.453125 C 5.949219 12.726562 5.824219 12.84375 5.53125 13 C 5.363281 13.085938 5.28125 13.101562 5 13.101562 C 4.695312 13.105469 4.648438 13.09375 4.421875 12.972656 C 4.152344 12.828125 3.996094 12.660156 3.859375 12.382812 C 3.734375 12.125 3.738281 11.617188 3.867188 11.347656 C 4.03125 11.011719 4.347656 10.753906 4.707031 10.660156 C 4.898438 10.609375 5.324219 10.652344 5.511719 10.738281 Z M 15.511719 10.738281 C 15.78125 10.867188 15.949219 11.027344 16.097656 11.296875 C 16.21875 11.523438 16.230469 11.570312 16.230469 11.875 C 16.230469 12.179688 16.21875 12.226562 16.097656 12.453125 C 15.949219 12.726562 15.824219 12.84375 15.53125 13 C 15.363281 13.085938 15.28125 13.101562 15 13.101562 C 14.695312 13.105469 14.648438 13.09375 14.421875 12.972656 C 14.152344 12.828125 13.996094 12.660156 13.859375 12.382812 C 13.734375 12.125 13.738281 11.617188 13.867188 11.347656 C 14.03125 11.011719 14.347656 10.753906 14.707031 10.660156 C 14.898438 10.609375 15.324219 10.652344 15.511719 10.738281 Z M 15.511719 10.738281 " />
                                        </g>
                                    </svg>
                                    <svg class="borracha" onclick="excluir_linha(this,false)"
                                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                        width="17px" height="17px" viewBox="0 0 15 15" version="1.1">
                                        <g id="surface1">
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 3.28125 12.65625 L 14.0625 12.65625 L 14.0625 13.59375 L 3.28125 13.59375 Z M 3.28125 12.65625 " />
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 12.835938 4.925781 L 9.117188 1.214844 C 8.941406 1.039062 8.703125 0.9375 8.453125 0.9375 C 8.207031 0.9375 7.964844 1.039062 7.789062 1.214844 L 1.226562 7.777344 C 1.050781 7.953125 0.953125 8.191406 0.953125 8.441406 C 0.953125 8.6875 1.050781 8.925781 1.226562 9.101562 L 3.34375 11.25 L 7.835938 11.25 L 12.835938 6.253906 C 13.011719 6.078125 13.109375 5.839844 13.109375 5.589844 C 13.109375 5.339844 13.011719 5.101562 12.835938 4.925781 Z M 7.449219 10.3125 L 3.75 10.3125 L 1.875 8.4375 L 4.832031 5.480469 L 8.550781 9.191406 Z M 9.210938 8.550781 L 5.5 4.832031 L 8.4375 1.875 L 12.1875 5.59375 Z M 9.210938 8.550781 " />
                                        </g>
                                    </svg>
                                </span>




                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,4)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,2)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,5)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onfocus="atendente(this)"
                                onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,6)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,7)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,3)" onfocus="horario_final(this)" contenteditable="true"
                                onblur="enviar_dados(this)">

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>

        <div id="setores" style="display: none;">
            <div id="filtro_setores">
                <table>
                    <tbody>
                        <tr>
                            <td>
                                <input oninput="filtrar_dados('setores')" type="text" placeholder="QTH..."
                                    name="setores_qth" id="setores_qth">
                            </td>
                            <td>
                                <input oninput="filtrar_dados('setores')" type="text" placeholder="Endere√ßo..."
                                    name="setores_endereco" id="setores_endereco">
                            </td>
                            <td>
                                <input oninput="filtrar_dados('setores')" type="text" placeholder="Tipo de Local..."
                                    name="setores_tipo_local" id="setores_tipo_local">
                            </td>
                            <td>
                                <input oninput="filtrar_dados('setores')" type="text" placeholder="Natureza Inicial..."
                                    name="setores_natureza" id="setores_natureza">
                            </td>
                            <td>
                                <input oninput="filtrar_dados('setores')" type="text" placeholder="Narrativa..."
                                    name="setores_narrativa" id="setores_narrativa">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="div_tabela_registros">
                <table id="setores_table">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="sortable">QTH</th>
                            <th class="sortable">ENDERE√áO</th>
                            <th class="sortable">TIPO DE LOCAL</th>
                            <th class="sortable">NATUREZA INICIAL</th>
                            <th class="sortable">NARRATIVA</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="width: 10px;">
                                <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                                    <svg class="borracha" onclick="excluir_linha(this,false)"
                                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                        width="17px" height="17px" viewBox="0 0 15 15" version="1.1">
                                        <g id="surface1">
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 3.28125 12.65625 L 14.0625 12.65625 L 14.0625 13.59375 L 3.28125 13.59375 Z M 3.28125 12.65625 " />
                                            <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                                d="M 12.835938 4.925781 L 9.117188 1.214844 C 8.941406 1.039062 8.703125 0.9375 8.453125 0.9375 C 8.207031 0.9375 7.964844 1.039062 7.789062 1.214844 L 1.226562 7.777344 C 1.050781 7.953125 0.953125 8.191406 0.953125 8.441406 C 0.953125 8.6875 1.050781 8.925781 1.226562 9.101562 L 3.34375 11.25 L 7.835938 11.25 L 12.835938 6.253906 C 13.011719 6.078125 13.109375 5.839844 13.109375 5.589844 C 13.109375 5.339844 13.011719 5.101562 12.835938 4.925781 Z M 7.449219 10.3125 L 3.75 10.3125 L 1.875 8.4375 L 4.832031 5.480469 L 8.550781 9.191406 Z M 9.210938 8.550781 L 5.5 4.832031 L 8.4375 1.875 L 12.1875 5.59375 Z M 9.210938 8.550781 " />
                                        </g>
                                    </svg>
                                </span>
                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                            <td oninput="filterOptions(this,8)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,4)" onblur="enviar_dados(this),hideOptions(event, this)"
                                contenteditable="true" onkeydown="teclas_atalho(this,event.key)">

                            </td>
                            <td oninput="filterOptions(this,3)" contenteditable="true" onblur="enviar_dados(this)">

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
        <div id="equipes" style="display: none;">
            <div id="filtro_equipes">
                <table>
                    <tbody>
                        <tr>
                            <td>
                                <button onclick="turno_atual(this)">Turno Atual</button>
                            </td>
                            <td>
                                <input oninput="filtrar_dados('equipes')" type="datetime-local"
                                    name="equipes_data_inicial" id="equipes_data_inicial">
                            </td>
                            <td>
                                <input oninput="filtrar_dados('equipes')" type="datetime-local"
                                    name="equipes_data_final" id="equipes_data_final">
                            </td>
                            <td>
                                <div class="dropdown" id="filtro_areas">
                                    <button class="dropdown-button">√Åreas</button>
                                    <div class="dropdown-content">
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="Todas">Todas</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="200 Cruzeiro">200 Cruzeiro</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="300 Partenon">300 Partenon</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="400 Leste">400 Leste</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="500 Restinga">500 Restinga</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="600 Norte">600 Norte</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="700 Eixo Baltazar">700 Eixo Baltazar</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="800 Pinheiro">800 Pinheiro</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="900 Sul">900 Sul</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="1000 Romu">1000 Romu</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="1100 Patam">1100 Patam</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="1200 Centro">1200 Centro</label>
                                        <label><input type="checkbox" oninput="filtro_areas(this)" checked
                                                value="Comando">Comando</label>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="dropdown" id="filtro_tipo">
                                    <button class="dropdown-button">Tipo</button>
                                    <div class="dropdown-content">
                                        <label><input type="checkbox" oninput="filtro_tipo_equipes(this)" checked
                                                value="Todas">Todas</label>
                                        <label><input type="checkbox" oninput="filtro_tipo_equipes(this)" checked
                                                value="Pessoas">Pessoas</label>
                                        <label><input type="checkbox" oninput="filtro_tipo_equipes(this)" checked
                                                value="Equipamentos">Equipamentos</label>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="div_tabela_registros">
                <table id="equipes_table">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="sortable">DATA-HORA</th>
                            <th class="sortable">GUARNI√á√ÉO</th>
                            <th class="sortable">GM/PREFIXO</th>
                            <th class="sortable">FUN√á√ÉO/MODELO</th>
                            <th class="sortable">AUTOR</th>

                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>

        </div>

        <div id="usu√°rios" style="display: none;">
            <table id="usu√°rios_table">
                <thead>
                    <tr>
                        <th></th>
                        <th class="sortable">Usu√°rio</th>
                        <th class="sortable">N√∫mero Nome</th>
                        <th class="sortable">Credencial</th>
                        <th>Senha</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><svg class="borracha" onclick="excluir_linha(this,false)" xmlns="http://www.w3.org/2000/svg"
                                xmlns:xlink="http://www.w3.org/1999/xlink" width="17px" height="17px"
                                viewBox="0 0 15 15" version="1.1">
                                <g id="surface1">
                                    <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                        d="M 3.28125 12.65625 L 14.0625 12.65625 L 14.0625 13.59375 L 3.28125 13.59375 Z M 3.28125 12.65625 " />
                                    <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                        d="M 12.835938 4.925781 L 9.117188 1.214844 C 8.941406 1.039062 8.703125 0.9375 8.453125 0.9375 C 8.207031 0.9375 7.964844 1.039062 7.789062 1.214844 L 1.226562 7.777344 C 1.050781 7.953125 0.953125 8.191406 0.953125 8.441406 C 0.953125 8.6875 1.050781 8.925781 1.226562 9.101562 L 3.34375 11.25 L 7.835938 11.25 L 12.835938 6.253906 C 13.011719 6.078125 13.109375 5.839844 13.109375 5.589844 C 13.109375 5.339844 13.011719 5.101562 12.835938 4.925781 Z M 7.449219 10.3125 L 3.75 10.3125 L 1.875 8.4375 L 4.832031 5.480469 L 8.550781 9.191406 Z M 9.210938 8.550781 L 5.5 4.832031 L 8.4375 1.875 L 12.1875 5.59375 Z M 9.210938 8.550781 " />
                                </g>
                            </svg></td>
                        <td contenteditable="true" oninput="filterOptions(this,3)" onblur="enviar_dados(this)"></td>
                        <td contenteditable="true" oninput="filterOptions(this,3)" onblur="enviar_dados(this)"></td>
                        <td contenteditable="true" oninput="filterOptions(this,3)" onblur="enviar_dados(this)"></td>
                        <td contenteditable="true" oninput="filterOptions(this,3)" onblur="enviar_dados(this)"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <ul id="options-list"></ul>
    </div>
    </div>
    <!-- Estrutura do modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fechar_modal()">&times;</span>
            <h2>LEGISLA√á√ÉO APLICADA</h2>

            <details>
                <summary>üò¥ PERTURBA√á√ÉO DO SOSSEGO</summary>

                <h4>LEI COMPLEMENTAR N¬∫ 12, DE 07 DE JANEIRO DE 1975</h4>
                <p>Art. 29-D S√£o deveres dos estabelecimentos, sem preju√≠zo √†s demais disposi√ß√µes legais:</p>
                <ul>
                    <li>I - apresentar, sempre que solicitado, o Alvar√° de Localiza√ß√£o e Funcionamento, nos casos
                        exigidos
                        em lei;</li>
                    <li>II - abster-se de depositar ou expor √† venda mercadorias sobre os passeios ou utilizando paredes
                        ou
                        v√£os, ou
                        sobre marquises ou toldos;</li>
                    <li>III - atender √†s exig√™ncias legais para o exerc√≠cio da atividade;</li>
                    <li>IV - n√£o exercer atividade em hor√°rio vedado por norma municipal;</li>
                    <li>V - n√£o utilizar equipamentos sonoros em infra√ß√£o √† legisla√ß√£o vigente;</li>
                </ul>

                <h4>LEI COMPLEMENTAR N¬∫ 983, DE 21 DE JULHO DE 2023</h4>
                <p>Art. 83 √â vedado perturbar o bem-estar e o sossego p√∫blico, ou de vizinhan√ßas, com ru√≠dos, barulhos,
                    sons
                    excessivos
                    ou inc√¥modos de qualquer natureza, produzidos por qualquer forma e que ultrapassem ou n√£o os n√≠veis
                    m√°ximos de
                    intensidade fixados nesta Lei. (Reda√ß√£o dada pela Lei Complementar n¬∫ 392/1996)</p>

                <p>Art. 85 N√£o poder√£o funcionar aos domingos e feriados e no hor√°rio compreendido entre 22h e 6h,
                    m√°quinas,
                    motores e
                    equipamentos eletro-ac√∫sticos em geral, de uso eventual, que, embora utilizando dispositivos para
                    amortecer os
                    efeitos de som, n√£o apresentem diminui√ß√£o sens√≠vel das perturba√ß√µes ou ru√≠dos.</p>
                <ul>
                    <li>Par√°grafo √önico - O funcionamento nos demais dias e hor√°rios depender√° de autoriza√ß√£o pr√©via do
                        setor competente
                        do Munic√≠pio. A infra√ß√£o do disposto neste artigo acarretar√° pena de multa de um a cinco
                        sal√°rios
                        m√≠nimos.</li>
                </ul>

                <p>Art. 86 Fica proibido:</p>
                <ul>
                    <li>IV - A utiliza√ß√£o de an√∫ncios de propaganda produzidos por alto-falantes, amplificadores, bandas
                        de
                        m√∫sica e
                        tambores;</li>
                    <li>V - A utiliza√ß√£o de alto-falantes, fon√≥grafos, r√°dios e outros aparelhos sonoros usados como
                        meio de
                        propaganda,
                        mesmo em casas de neg√≥cios, ou para outros fins, desde que se fa√ßam ouvir fora do recinto onde
                        funcionam; Pena:
                        multa de um a tr√™s sal√°rios m√≠nimos.</li>
                    <li>VIII - Emitir sinal sonoro por alarmes de seguran√ßa residenciais, comerciais ou veiculares por
                        per√≠odo superior
                        a 5 (cinco) minutos.</li>
                </ul>

                <p>Art. 89 Casas de com√©rcio ou locais de divers√µes p√∫blicas como parques, bares, caf√©s, restaurantes,
                    cantinas e
                    boates, nas quais haja execu√ß√£o ou reprodu√ß√£o de n√∫meros musicais por orquestras, instrumentos
                    isolados
                    ou aparelhos
                    de som, dever√£o adotar instala√ß√µes adequadas a reduzir sensivelmente a intensidade de suas execu√ß√µes
                    ou
                    reprodu√ß√µes,
                    de modo a n√£o perturbar o sossego da vizinhan√ßa.</p>

                <h4>DECRETO N¬∫ 8185, DE 07 DE MAR√áO DE 1983 (SMAMUS)</h4>
                <p>Art. 7¬∫ Fica proibido o uso ou a opera√ß√£o, inclusive comercial, de instrumentos ou equipamentos, de
                    modo
                    que o som
                    emitido provoque dist√∫rbio sonoro.</p>
                <ul>
                    <li>III - Utilizar alto-falantes, fon√≥grafos, r√°dios e outros aparelhos sonoros usados como meio de
                        propaganda,
                        mesmo em casas de neg√≥cios ou para outros fins, desde que causem dist√∫rbio sonoro.</li>
                    <li>VII - Operar, executar ou permitir a opera√ß√£o ou execu√ß√£o de qualquer instrumento musical,
                        amplificado
                        eletronicamente ou n√£o, r√°dio, fon√≥grafo, aparelho de televis√£o ou dispositivo similar que
                        produza,
                        reproduza ou
                        amplifique som em qualquer lugar de entretenimento p√∫blico, sem autoriza√ß√£o da SMAM.</li>
                </ul>
                <h3>RECOMENDA√á√ÉO DE RITO AO FISCALIZAR COM√âRCIO</h3>

                <h4>LEI COMPLEMENTAR N¬∫ 12, DE 07 DE JANEIRO DE 1975</h4>

                <p>Art. 18 √â proibido nos logradouros p√∫blicos:</p>
                <ul>
                    <li>IX - Embara√ßar ou impedir, por qualquer meio, o livre tr√¢nsito de pedestres ou ve√≠culos nos
                        logradouros
                        p√∫blicos, bem como usar correntes ou artefatos de prote√ß√£o nos canteiros centrais das vias
                        p√∫blicas
                        e nos
                        equipamentos p√∫blicos.</li>
                    <li>XIII - Colocar mesas, cadeiras, bancas ou quaisquer outros objetos ou mercadorias, qualquer que
                        seja
                        a
                        finalidade, excetuando-se os casos regulados por legisla√ß√£o espec√≠fica, desde que previamente
                        autorizados pelo
                        Munic√≠pio.</li>
                </ul>

                <h4>LEI COMPLEMENTAR N¬∫ 972, DE 2 DE MAIO DE 2023</h4>

                <p>Art. 2¬∫ A coloca√ß√£o de equipamentos m√≥veis nos locais referidos no caput do art. 1¬∫ desta Lei
                    Complementar dever√°
                    respeitar as seguintes dist√¢ncias:</p>
                <ul>
                    <li>I - 1,5m (um v√≠rgula cinco metros) de largura para o livre tr√¢nsito de pedestres,
                        compatibilizado
                        com o
                        mobili√°rio urbano, quando houver;</li>
                    <li>II - 1m (um metro) de largura, em cada lado dos acessos de garagens;</li>
                    <li>III - 5m (cinco metros), a partir do per√≠metro de abrigos e paradas de √¥nibus, pontos de t√°xi e
                        de
                        lota√ß√£o,
                        terminais de √¥nibus ou outro mobili√°rio de grande porte; e</li>
                    <li>IV - 7m (sete metros) da esquina, definida pelo encontro dos alinhamentos dos lotes das faces de
                        quadra que a
                        comp√µem, para estabelecimentos que nela estejam localizados, preservando a acessibilidade nos
                        cruzamentos
                        vi√°rios.</li>
                </ul>

                <h4>LEI COMPLEMENTAR N¬∫ 12, DE 07 DE JANEIRO DE 1975</h4>

                <p>Art. 18 √â proibido nos logradouros p√∫blicos:</p>
                <ul>
                    <li>XIV - Colocar marquises ou toldos sobre os passeios, qualquer que seja o material empregado, sem
                        pr√©via
                        autoriza√ß√£o do Munic√≠pio;</li>
                    <li>XVI - Estacionar, por mais de vinte e quatro (24) horas seguidas, ve√≠culos equipados para
                        atividade
                        comercial;
                    </li>
                </ul>

                <p>Art. 29-C A aus√™ncia do Alvar√° de Localiza√ß√£o e Funcionamento para a atividade econ√¥mica ou
                    associativa
                    que exija ato
                    p√∫blico de libera√ß√£o √© considerada infra√ß√£o e, respeitada a ampla defesa e o contradit√≥rio,
                    aplicar-se-√°
                    ao infrator
                    respons√°vel pela atividade, mediante processo administrativo na forma da lei.</p>

                <p>Art. 29-D S√£o deveres dos estabelecimentos, sem preju√≠zo √†s demais disposi√ß√µes legais:</p>
                <ul>
                    <li>I - Apresentar, sempre que solicitado, o Alvar√° de Localiza√ß√£o e Funcionamento, nos casos
                        exigidos
                        em lei;</li>
                    <li>II - Abster-se de depositar ou expor √† venda mercadorias sobre os passeios ou utilizando paredes
                        ou
                        v√£os, ou
                        sobre marquises ou toldos;</li>
                    <li>III - Atender √†s exig√™ncias legais para o exerc√≠cio da atividade;</li>
                    <li>IV - N√£o exercer atividade em hor√°rio vedado por norma municipal;</li>
                    <li>V - N√£o utilizar equipamentos sonoros em infra√ß√£o √† legisla√ß√£o vigente;</li>
                </ul>

                <p>Art. 82 Os estabelecimentos que produzam fuma√ßa, desprendam odores desagrad√°veis, inc√¥modos ou
                    prejudiciais √† sa√∫de,
                    dever√£o instalar dispositivos para eliminar ou reduzir ao m√≠nimo os fatores da polui√ß√£o, de acordo
                    com
                    os programas
                    e projetos implantados ou aprovados pelo Munic√≠pio.</p>

                <p>Art. 91-B Os estabelecimentos que comercializam tintas em embalagens do tipo spray dever√£o manter
                    cadastro na
                    Secretaria Municipal do Desenvolvimento Econ√¥mico (SMDE), nos termos definidos em regulamento.
                    (Reda√ß√£o
                    acrescida
                    pela Lei Complementar n¬∫ 832/2018)</p>

                <p>Art. 91-C Ficam sujeitos √† multa de 650 (seiscentas e cinquenta) UFMs a 2.600 (duas mil e seiscentas)
                    UFMs os
                    estabelecimentos comerciais que cometerem as seguintes infra√ß√µes administrativas:</p>
                <ul>
                    <li>I - Vender tintas em embalagens do tipo spray sem o cadastro referido no art. 91-B desta Lei
                        Complementar; ou
                    </li>
                    <li>II - Vender tintas em embalagens do tipo spray √† pessoa com menos de 18 (dezoito) anos de idade.
                    </li>
                </ul>
                <p>Par√°grafo √∫nico. Em caso de reincid√™ncia, a multa referida no caput deste artigo ser√° aplicada em
                    dobro,
                    ficando o
                    estabelecimento sujeito √† suspens√£o parcial ou total de suas atividades. (Reda√ß√£o acrescida pela Lei
                    Complementar n¬∫
                    832/2018)</p>

                <p>Art. 91-D Em caso de reincid√™ncia das infra√ß√µes estabelecidas nesta Lei Complementar ou quando a
                    pr√°tica
                    da conduta
                    por ela vedada acarretar dano ao patrim√¥nio p√∫blico tombado, a san√ß√£o de multa ser√° aplicada em
                    dobro.
                    (Reda√ß√£o
                    acrescida pela Lei Complementar n¬∫ 832/2018)</p>
            </details>
            <details>
                <summary>üèóÔ∏è PERTURBA√á√ÉO DO SOSSEGO (OBRAS)</summary>

                <h4>DECRETO N¬∫ 8185, DE 07 MAR√áO DE 1983 (SMAMUS)</h4>

                <p>Art. 9¬∫ Sem a devida autoriza√ß√£o especial, ficam proibidos os servi√ßos de constru√ß√£o civil nos
                    seguintes dias e
                    hor√°rios:</p>
                <ul>
                    <li>a) Domingos e feriados - a qualquer hora.</li>
                    <li>b) Em dias √∫teis - nos hor√°rios vespertino e noturno. (Somente √© permitida a realiza√ß√£o de obras
                        de 2¬™ feira
                        a s√°bado, das 7h √†s 19h, exceto quando se tratar de obras p√∫blicas de emerg√™ncia ou urg√™ncia.)
                    </li>
                </ul>
                <p>Par√°grafo √∫nico. Fica a crit√©rio da SMAM limitar os dias e hor√°rios permitidos em unidades
                    territoriais
                    residenciais e zonas sens√≠veis a ru√≠dos.</p>

                <p>Art. 10 N√£o √© permitida a utiliza√ß√£o de quaisquer ferramentas ou equipamentos, execu√ß√£o de servi√ßos
                    de carga e
                    descarga, consertos, servi√ßos de constru√ß√£o em dias √∫teis, domingos e feriados, de modo que o som
                    assim
                    originado ultrapasse aos valores m√°ximos fixados neste Decreto.</p>

                <h4>LEI COMPLEMENTAR N¬∫ 12, DE 07 DE JANEIRO DE 1975</h4>

                <p>Art. 26 Constitui infra√ß√£o:</p>
                <ul>
                    <li>I - N√£o ter ou deixar de exibir, quando solicitado pela Fiscaliza√ß√£o, no local da obra, o
                        projeto aprovado e
                        a licen√ßa de execu√ß√£o;<br>
                        <strong>Pena:</strong> multa de um a cinco sal√°rios m√≠nimos.
                    </li>
                </ul>

                <p>Art. 85 N√£o poder√£o funcionar aos domingos e feriados e no hor√°rio compreendido entre 22h e 6h,
                    m√°quinas, motores
                    e equipamentos eletro-ac√∫sticos em geral, de uso eventual, que, embora utilizando dispositivos para
                    amortecer os
                    efeitos de som, n√£o apresentem diminui√ß√£o sens√≠vel das perturba√ß√µes ou ru√≠dos.</p>
                <p>Par√°grafo √önico - O funcionamento nos demais dias e hor√°rios depender√° de autoriza√ß√£o pr√©via do setor
                    competente
                    do Munic√≠pio. A infra√ß√£o do disposto neste artigo acarretar√° pena de multa de um a cinco sal√°rios
                    m√≠nimos.</p>
            </details>
            <details>
                <summary>‚ö±üí® PICHA√á√ÉO</summary>

                <h4>LEI COMPLEMENTAR N¬∫ 12, DE 07 DE JANEIRO DE 1975</h4>

                <p>Art. 91-A Fica proibido pichar ou, por qualquer outro meio, conspurcar edifica√ß√£o ou monumento,
                    p√∫blicos ou
                    particulares.</p>

                <p>¬ß 1¬∫ A infra√ß√£o do disposto neste artigo acarretar√° lavratura de auto de infra√ß√£o, nos termos do art.
                    6¬∫ desta
                    Lei Complementar.</p>

                <p>¬ß 2¬∫ O descumprimento ao disposto no caput deste artigo acarretar√° ao infrator:</p>
                <ul>
                    <li>I - Multa de 750 (setecentos e cinquenta) a 2.600 (duas mil e seiscentas) UFMs, aplicada em
                        dobro em caso de
                        reincid√™ncia; e</li>
                    <li>II - Obriga√ß√£o de repara√ß√£o de dano, que consiste em eliminar as marcas da picha√ß√£o e pintar
                        integralmente a
                        edifica√ß√£o ou o monumento.</li>
                </ul>

                <p>¬ß 3¬∫ Independentemente da aplica√ß√£o da multa ao autor do delito, sempre que a repara√ß√£o do dano de
                    picha√ß√£o
                    depender de profissional t√©cnico devidamente habilitado para o encargo, a execu√ß√£o de seu trabalho
                    ser√°
                    ressarcida diretamente pelo agente infrator, independentemente se efetivada em edifica√ß√£o ou
                    monumento, p√∫blico
                    ou privado, de reconhecido valor art√≠stico, arqueol√≥gico ou hist√≥rico, ou nos demais casos em que se
                    verifique
                    invi√°vel a plena e geral repara√ß√£o do dano pelo pr√≥prio respons√°vel.</p>

                <p>¬ß 4¬∫ S√≥ ser√° permitida a picha√ß√£o em tapumes ou cercamentos de obras e constru√ß√µes, p√∫blicas ou
                    privadas,
                    mediante autoriza√ß√£o de √≥rg√£o p√∫blico respons√°vel ou do propriet√°rio, respectivamente, sendo que
                    essas dever√£o
                    ter car√°ter educativo, informativo ou art√≠stico, e as picha√ß√µes voltadas ao car√°ter educativo e
                    informativo
                    dever√£o respeitar padr√£o determinado pelo Executivo Municipal.</p>

                <p>¬ß 5¬∫ Alternativa ou anteriormente √† aplica√ß√£o da multa prevista no inc. I do ¬ß 2¬∫ deste artigo, a
                    Administra√ß√£o
                    proceder√° ao devido flagrante na √°rea policial e √† instaura√ß√£o do processo administrativo que
                    decidir√° pela
                    aplica√ß√£o da multa, pela forma de reparo ao dano ou pelo envio do processo √† Procuradoria-Geral do
                    Munic√≠pio de
                    Porto Alegre para proposi√ß√£o de a√ß√£o judicial c√≠vel de repara√ß√£o de dano ao patrim√¥nio.</p>

                <p>¬ß 6¬∫ Os valores arrecadados com a aplica√ß√£o das multas previstas no caput e no inc. I do ¬ß 2¬∫ deste
                    artigo ser√£o
                    destinados ao Departamento Municipal de Limpeza Urbana (DMLU), para que este promova as a√ß√µes
                    necess√°rias √†
                    conserva√ß√£o e √† repara√ß√£o de danos causados pela picha√ß√£o.</p>

                <p>Art. 91-B Os estabelecimentos que comercializam tintas em embalagens do tipo spray dever√£o manter
                    cadastro na
                    Secretaria Municipal do Desenvolvimento Econ√¥mico (SMDE), nos termos definidos em regulamento.</p>

                <p>Art. 91-C Ficam sujeitos √† multa de 650 (seiscentas e cinquenta) UFMs a 2.600 (duas mil e seiscentas)
                    UFMs os
                    estabelecimentos comerciais que cometerem as seguintes infra√ß√µes administrativas:</p>
                <ul>
                    <li>I - Vender tintas em embalagens do tipo spray sem o cadastro referido no art. 91-B desta Lei
                        Complementar;
                        ou</li>
                    <li>II - Vender tintas em embalagens do tipo spray √† pessoa com menos de 18 (dezoito) anos de idade.
                    </li>
                </ul>

                <p>Par√°grafo √∫nico. Em caso de reincid√™ncia, a multa referida no caput deste artigo ser√° aplicada em
                    dobro, ficando
                    o estabelecimento sujeito √† suspens√£o parcial ou total de suas atividades.</p>

                <p>Art. 91-D Em caso de reincid√™ncia das infra√ß√µes estabelecidas nesta Lei Complementar ou quando a
                    pr√°tica da
                    conduta por ela vedada acarretar dano ao patrim√¥nio p√∫blico tombado, a san√ß√£o de multa ser√° aplicada
                    em dobro.
                </p>

                <h4>RECOMENDA√á√ÉO DE RITO AO FISCALIZAR PICHA√á√ÉO</h4>
                <ul>
                    <li>Fotografar a picha√ß√£o sempre que poss√≠vel de forma n√≠tida;</li>
                    <li>Descrever no corpo do auto de infra√ß√£o de acordo com LP n¬∞ 992/23 Art. 79 V: descri√ß√£o da
                        irregularidade
                        constatada e indica√ß√£o do dispositivo legal.</li>
                </ul>

                <p><strong>Exemplo de descri√ß√£o:</strong></p>
                <ul>
                    <li>Cores utilizadas na picha√ß√£o;</li>
                    <li>Textos ou palavras escritos (n√∫meros e letras);</li>
                    <li>Desenhos;</li>
                    <li>Medidas mensur√°veis do dano;</li>
                    <li>Material utilizado.</li>
                </ul>
            </details>

            <details>
                <summary>üê∂ ANIMAIS</summary>

                <h4>DECRETO N¬∫ 18.587, DE 13 DE MAR√áO DE 2014</h4>

                <p>Art. 7¬∫ √â vedada qualquer pr√°tica de maus tratos aos animais.</p>
                <ul>
                    <li>¬ß 1¬∫ Praticar ato de abuso ou crueldade contra qualquer animal sujeita o infrator √† multa de 720
                        (setecentas
                        e vinte) UFMs.</li>
                    <li>¬ß 2¬∫ Manter animais em lugares anti-higi√™nicos ou que lhe impe√ßam a respira√ß√£o, o movimento ou o
                        descanso,
                        ou os privem de ar ou luz, sujeita o infrator √† multa de 240 (duzentas e quarenta) UFMs.</li>
                    <li>¬ß 3¬∫ Submeter animais a trabalhos excessivos ou superiores √†s suas for√ßas, causando-lhes
                        sofrimento, sujeita
                        o infrator √† multa de 360 (trezentas e sessenta) UFMs.</li>
                    <li>¬ß 4¬∫ A√ßoitar, galopear, ferir ou mutilar animais sujeita o infrator √† multa de 720 (setecentas e
                        vinte)
                        UFMs.</li>
                    <li>¬ß 5¬∫ Abandonar animais sujeita o infrator √† multa de 2.520 (duas mil quinhentas e vinte) UFMs.
                    </li>
                    <li>¬ß 6¬∫ Conduzir animais sem arreios ou apetrechos adequados, causando-lhes inc√¥modo ou sofrimento,
                        sujeita o
                        infrator √† multa de 360 (trezentas e sessenta) UFMs.</li>
                    <li>¬ß 7¬∫ N√£o fornecer ao animal √°gua e alimenta√ß√£o sujeita o infrator √† multa de 240 (duzentas e
                        quarenta) UFMs.
                    </li>
                    <li>¬ß 8¬∫ Deixar de fornecer a necess√°ria assist√™ncia ao animal sujeita o infrator √† multa de 360
                        (trezentas e
                        sessenta) UFMs.</li>
                </ul>

                <p>Art. 8¬∫ √â vedada a veicula√ß√£o de publicidade em animais ou por meio deles.</p>
                <p>Par√°grafo √önico - Em caso de n√£o cumprimento ao disposto no caput deste artigo, o guardi√£o ou
                    respons√°vel estar√°
                    sujeito √† multa de 60 (sessenta) UFMs.</p>

                <p>Art. 12 Em resid√™ncia, condom√≠nio ou estabelecimento que possua c√£o ou animal bravio, √© obrigat√≥ria:
                </p>
                <ul>
                    <li>I - A instala√ß√£o de placa vis√≠vel e de f√°cil leitura, alertando os transeuntes da exist√™ncia de
                        animais, sob
                        pena de multa de 20 (vinte) UFMs.</li>
                    <li>II - A exist√™ncia de muros ou grades de ferro e de port√µes de seguran√ßa capazes de garantir a
                        perman√™ncia
                        domiciliada dos animais e a prote√ß√£o aos transeuntes, sob pena de multa de 120 (cento e vinte)
                        UFMs.</li>
                    <li>III - A instala√ß√£o de equipamentos para a entrega de correspond√™ncia e a coleta de res√≠duos, de
                        modo a
                        evitar o contato do animal com os trabalhadores, sob pena de multa de 60 (sessenta) UFMs.</li>
                </ul>

                <p>Art. 30 S√£o proibidas:</p>
                <ul>
                    <li>I - A exibi√ß√£o de animais silvestres ou ex√≥ticos em vias p√∫blicas, bem como a sua utiliza√ß√£o em
                        apresenta√ß√µes art√≠sticas de divers√µes p√∫blicas;</li>
                    <li>II - A exibi√ß√£o de animais bravios em espet√°culos;</li>
                    <li>III - A utiliza√ß√£o e a exibi√ß√£o de animais em eventos circenses; e</li>
                    <li>IV - A realiza√ß√£o de rinhas de animais, tais como de c√£es e aves.</li>
                </ul>
                <p>Par√°grafo √önico - Em caso de n√£o cumprimento ao disposto nos incs. I, II, III ou IV deste artigo, o
                    respons√°vel
                    estar√° sujeito √† multa de 3.600 (tr√™s mil e seiscentas) UFMs, para cada uma das infra√ß√µes.</p>

                <p>Art. 31 √â proibido o passeio com c√£es em vias e logradouros p√∫blicos, exceto se conduzidos por
                    pessoas com for√ßa
                    suficiente para controlar os movimentos do animal e se utilizadas adequadamente a coleira e a guia.
                </p>
                <ul>
                    <li>¬ß 1¬∫ Em caso de n√£o cumprimento ao disposto no caput deste artigo, o guardi√£o ou respons√°vel
                        estar√° sujeito
                        √† multa de 60 (sessenta) UFMs.</li>
                    <li>¬ß 2¬∫ Os c√£es considerados de guarda, de combate ou de outra aptid√£o em que se destaquem
                        componentes de for√ßa
                        ou de potencial agressivo, salvo os c√£es pertencentes a √≥rg√£os oficiais, somente poder√£o sair √†s
                        ruas usando
                        focinheira e enforcador de a√ßo, sob pena de multa de 60 (sessenta) UFMs.</li>
                </ul>

                <p>Art. 32 O recolhimento de dejetos de animal em logradouros e demais espa√ßos p√∫blicos √©
                    responsabilidade de seu
                    respectivo guardi√£o ou condutor.</p>
                <p>Par√°grafo √önico - Em caso de n√£o cumprimento ao disposto no caput deste artigo, o guardi√£o ou
                    respons√°vel estar√°
                    sujeito √† multa de 120 (cento e vinte) UFMs.</p>

                <p>Art. 33 Os c√£es considerados de guarda, de combate ou de outra aptid√£o em que se destaquem
                    componentes de for√ßa
                    ou de potencial agressivo, dever√£o ser identificados com microchip, quando atingirem a idade de 6
                    (seis) meses,
                    no qual ser√£o informados as caracter√≠sticas do animal e o nome do seu guardi√£o ou respons√°vel, √†s
                    expensas do
                    guardi√£o ou respons√°vel pelo animal, e cadastrado no √≥rg√£o municipal competente.</p>
                <p>Par√°grafo √önico - Em caso de n√£o cumprimento ao disposto no caput deste artigo, o guardi√£o ou
                    respons√°vel estar√°
                    sujeito √† multa de 360 UFMs.</p>

                <p>Art. 34 √â proibida a perman√™ncia de animais, com propriet√°rio, soltos ou amarrados em vias e
                    logradouros p√∫blicos
                    e em locais de livre acesso ao p√∫blico.</p>
                <p>Par√°grafo √önico - Em caso de n√£o cumprimento ao disposto no caput deste artigo, o guardi√£o ou
                    respons√°vel estar√°
                    sujeito √† multa de 120 (cento e vinte) UFMs.</p>
            </details>
            <details>
                <summary>üé∂ MANIFESTA√á√ïES E EVENTOS</summary>

                <h4>CONSTITUI√á√ÉO DA REP√öBLICA FEDERATIVA DO BRASIL DE 1988</h4>
                <p>Art. 5¬∫ Todos s√£o iguais perante a lei, sem distin√ß√£o de qualquer natureza, garantindo-se aos
                    brasileiros e aos
                    estrangeiros residentes no Pa√≠s a inviolabilidade do direito √† vida, √† liberdade, √† igualdade, √†
                    seguran√ßa e √†
                    propriedade, nos termos seguintes:</p>
                <ul>
                    <li>IX - √â livre a express√£o da atividade intelectual, art√≠stica, cient√≠fica e de comunica√ß√£o,
                        independentemente
                        de censura ou licen√ßa.</li>
                </ul>

                <h4>LEI N¬∫ 12.821, DE 11 DE MAR√áO DE 2021</h4>

                <p>Art. 1¬∫ Ficam permitidas manifesta√ß√µes culturais, religiosas, sociais, esportivas e de artistas de
                    rua em espa√ßos
                    p√∫blicos abertos do Munic√≠pio de Porto Alegre, tais como pra√ßas, anfiteatros, largos e vias.</p>

                <p>Art. 2¬∫ A permiss√£o de que trata o art. 1¬∫ desta Lei fica condicionada √† observ√¢ncia dos seguintes
                    requisitos:
                </p>
                <ul>
                    <li>I - Gratuidade para os espectadores, permitidas doa√ß√µes espont√¢neas;</li>
                    <li>II - Permiss√£o da livre flu√™ncia do tr√¢nsito, da passagem e da circula√ß√£o de pedestres, bem como
                        do acesso a
                        instala√ß√µes p√∫blicas ou privadas;</li>
                    <li>III - Em caso de utiliza√ß√£o de fonte de energia para alimenta√ß√£o de som, a pot√™ncia desse
                        equipamento ser√°
                        de, no m√°ximo, 30 (trinta) kVA; e</li>
                    <li>IV - Inexist√™ncia de patroc√≠nio privado que caracterize as manifesta√ß√µes como um evento de
                        marketing, salvo
                        projetos apoiados por leis municipais, estaduais ou federais de incentivo √† cultura.</li>
                </ul>

                <p>Art. 3¬∫ Para os fins desta Lei, consideram-se manifesta√ß√µes culturais de artistas de rua aquelas que
                    compreendam:
                </p>
                <ul>
                    <li>I - Teatro;</li>
                    <li>II - Dan√ßa;</li>
                    <li>III - Capoeira;</li>
                    <li>IV - Folclore;</li>
                    <li>V - Representa√ß√£o por m√≠mica, inclusive as est√°tuas vivas;</li>
                    <li>VI - Artes circenses em geral, abrangendo a arte dos palha√ßos, dos m√°gicos, do malabarismo e dos
                        saltos
                        mortais no ch√£o ou em trap√©zios;</li>
                    <li>VII - Artes pl√°sticas de qualquer natureza;</li>
                    <li>VIII - Espet√°culo ou apresenta√ß√£o de m√∫sica, erudita ou popular, vocal ou instrumental;</li>
                    <li>IX - Literatura, poesia, desafios po√©ticos, poesia de cordel, improvisa√ß√£o e repentistas; e</li>
                    <li>X - Recital, declama√ß√£o ou cantata de texto.</li>
                </ul>

                <p>¬ß 1¬∫ Durante as manifesta√ß√µes culturais previstas neste artigo, fica permitido ao artista receber
                    doa√ß√£o
                    espont√¢nea em troca de bens culturais dur√°veis, vinculados √†s apresenta√ß√µes dos artistas ou dos
                    grupos.</p>
                <p>¬ß 2¬∫ As manifesta√ß√µes culturais de artistas de rua independem de pr√©via autoriza√ß√£o dos √≥rg√£os
                    p√∫blicos
                    municipais e n√£o est√£o sujeitas √† cobran√ßa de quaisquer tributos ou pre√ßos p√∫blicos.</p>

                <p>Art. 4¬∫ As manifesta√ß√µes culturais de que trata esta Lei independem de pr√©via autoriza√ß√£o dos √≥rg√£os
                    p√∫blicos
                    municipais e n√£o est√£o sujeitas √† cobran√ßa de quaisquer tributos ou pre√ßos p√∫blicos.</p>
                <ul>
                    <li>¬ß 1¬∫ O respons√°vel pela manifesta√ß√£o cultural informar√° ao Executivo Municipal o dia e a hora de
                        sua
                        realiza√ß√£o, a fim de compatibilizar o compartilhamento do espa√ßo, se for o caso, com outra
                        atividade da
                        mesma natureza no mesmo dia e no mesmo local e de possibilitar pr√©via divulga√ß√£o.</li>
                    <li>¬ß 2¬∫ Eventuais pedidos de bloqueios de vias para a realiza√ß√£o das manifesta√ß√µes descritas no
                        caput do art.
                        1¬∫ desta Lei poder√£o ser analisados, excepcionalmente, pelo Executivo Municipal.</li>
                </ul>

                <p>Art. 5¬∫ Fica vedado o uso de espa√ßos p√∫blicos para as atividades elencadas no caput do art. 1¬∫ desta
                    Lei que
                    possam causar preju√≠zo √† preserva√ß√£o do meio ambiente e do patrim√¥nio p√∫blico.</p>
                <p>Par√°grafo √∫nico. A pessoa f√≠sica ou jur√≠dica autorizada na forma desta Lei fica obrigada a ressarcir
                    o Munic√≠pio
                    de Porto Alegre por quaisquer danos ambientais ou f√≠sicos causados aos espa√ßos p√∫blicos, bem como
                    por qualquer
                    avaria aos equipamentos ou estruturas p√∫blicas em decorr√™ncia das atividades realizadas.</p>
            </details>
            <details>
                <summary>üöó GUARDADOR DE VE√çCULOS</summary>

                <h4>LEI COMPLEMENTAR N¬∫ 874, DE 15 DE JANEIRO DE 2020</h4>

                <p>Art. 1¬∫ Fica proibida a atividade de guardador aut√¥nomo de ve√≠culos automotores ‚Äî flanelinhas ‚Äî ou
                    assemelhados
                    nas vias e nos logradouros p√∫blicos do Munic√≠pio de Porto Alegre.</p>

                <p>Art. 5¬∫ O n√£o cumprimento ao disposto nesta Lei Complementar sujeitar√° o infrator a multa no valor de
                    R$ 300,00
                    (trezentos reais), aplicada em dobro em caso de reincid√™ncia.</p>
            </details>

        </div>
    </div>
    <script>
        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBag5uPzTK0sXx3nBzjGhmlmSCySO3u3_U",
            authDomain: "rotinas-8498d.firebaseapp.com",
            projectId: "rotinas-8498d",
            storageBucket: "rotinas-8498d.firebasestorage.app",
            messagingSenderId: "1053551077085",
            appId: "1:1053551077085:web:4b2dcbbeb60f9f7fee1d34"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function login() {
            const login = document.querySelector('#usuario').value.trim();
            const senha = document.querySelector('#senha').value;
            const tela_aviso = document.querySelector('#tela_aviso');
            tela_aviso.innerText = '';

            if (!login || !senha) {
                tela_aviso.innerText = 'Preencha usu√°rio e senha.';
                return;
            }

            db.collection('users').doc(login).get()
                .then((doc) => {
                    if (!doc.exists) {
                        tela_aviso.innerText = 'Usu√°rio n√£o encontrado.';
                        return;
                    }

                    const dados = doc.data();
                    const hashSalvo = dados.senha;

                    // Criar hash da senha digitada para comparar
                    const senhaHash = CryptoJS.SHA256(senha).toString();

                    if (senhaHash !== hashSalvo) {
                        tela_aviso.innerText = 'Senha incorreta.';
                        return;
                    }

                    // Verifica se a senha √© a padr√£o '12345' (hash dela)
                    const hashSenhaPadrao = CryptoJS.SHA256('12345').toString();

                    if (hashSalvo === hashSenhaPadrao) {
                        // Primeiro acesso
                        document.querySelector('#primeiro_acesso').style.display = '';
                        document.querySelector('#login').style.display = 'none';
                        sessionStorage.setItem('primeiro_acesso', doc.id);
                    } else {
                        // Acesso normal
                        document.querySelector('#programa').style.display = '';
                        document.querySelector('#login').style.display = 'none';
                        sessionStorage.setItem('usuario_logado', JSON.stringify(dados));
                        document.querySelectorAll("#rotinas_table tbody tr,#chamadas_table tbody tr,#setores_table tbody tr").forEach(tr => {
                            tr.setAttribute('name', JSON.parse(sessionStorage.getItem('usuario_logado')).nome + '-**-' + new Date().getTime());
                        });
                    }
                })
                .catch((error) => {
                    console.error("Erro ao buscar usu√°rio:", error);
                    tela_aviso.innerText = 'Erro ao acessar o sistema.';
                });
        }


        function primeiro_acesso() {
            const senha_primeiro_acesso = document.querySelector('#senha_primeiro_acesso').value;
            const repetir_senha = document.querySelector('#repetir_senha_primeiro_acesso').value;
            const tela_aviso = document.querySelector('#tela_aviso_primeiro_acesso');
            const userId = sessionStorage.getItem('primeiro_acesso');

            tela_aviso.innerText = '';

            if (!senha_primeiro_acesso || !repetir_senha) {
                tela_aviso.innerText = "Preencha todos os campos.";
                return;
            }

            if (senha_primeiro_acesso !== repetir_senha) {
                tela_aviso.innerText = "As senhas n√£o coincidem.";
                return;
            }

            if (senha_primeiro_acesso === '12345') {
                tela_aviso.innerText = "Por favor, escolha uma senha mais segura que '12345'.";
                return;
            }

            // Cria hash SHA-256 da senha nova
            const hash = CryptoJS.SHA256(senha_primeiro_acesso).toString();

            // Atualiza senha no Firestore
            db.collection('users').doc(userId).update({ senha: hash })
                .then(() => {
                    return db.collection('users').doc(userId).get();
                })
                .then((doc) => {
                    if (doc.exists) {
                        const nome = doc.data().nome || "Usu√°rio";
                        sessionStorage.setItem('usuario_logado', nome);

                        document.querySelector('#programa').style.display = 'none';
                        document.querySelector('#login').style.display = '';
                        document.querySelector('#primeiro_acesso').style.display = 'none';
                        sessionStorage.removeItem('primeiro_acesso');
                        sessionStorage.removeItem('usuario_logado');
                    } else {
                        console.warn("Usu√°rio n√£o encontrado ap√≥s atualiza√ß√£o.");
                    }
                })
                .catch((error) => {
                    console.error("Erro ao salvar a senha:", error);
                    tela_aviso.innerText = "Erro ao salvar a senha.";
                });
        }

        function logout() {
            sessionStorage.clear();
            window.location.reload();
        }

        function baixa_banco() {
            //baixar os dados de qths, gus, qru
            db.collection("dados_fixos").onSnapshot((snapshot) => {
                snapshot.forEach((doc) => {
                    localStorage.setItem(doc.id, JSON.stringify(doc.data()).replace(/\n/g, "<br>"));
                    // Armazenar os dados do documento no localStorage

                    if (doc.data().qth) {
                        document.querySelectorAll('#setores_table tbody tr').forEach(linha => {
                            if (!doc.data().qth.includes(linha.getAttribute('name')) && linha.querySelectorAll('td')[1].innerText != '' && linha.querySelectorAll('td')[2].innerText != '') {
                                linha.remove();
                            }
                        });
                        let linhas = '';
                        doc.data().qth.replace(/\n/g, "<br>").split('-++-').forEach(setor => {
                            if (!setor) return;

                            const celulas = setor.split('-()-');
                            const l = criar_linha('setores', celulas);
                            const lin = document.querySelector(`#setores_table tr[name='${celulas[0]}']`);
                            if (lin) {

                                if (lin.querySelectorAll('td')[1].innerText.trim().replaceAll('  ', ' ') != celulas[1].trim().replaceAll('  ', ' ') || lin.querySelectorAll('td')[2].innerText.trim().replaceAll('  ', ' ') != celulas[4].trim().replaceAll('  ', ' ') || lin.querySelectorAll('td')[3].innerText.trim().replaceAll('  ', ' ') != celulas[2].trim().replaceAll('  ', ' ') || lin.querySelectorAll('td')[4].innerText.trim().replaceAll('  ', ' ') != celulas[5].trim().replaceAll('  ', ' ') || lin.querySelectorAll('td')[5].innerText.trim().replaceAll('  ', ' ') != celulas[3].trim().replaceAll('  ', ' ')) {
                                    document.querySelector(`#setores_table tr[name='${celulas[0]}']`).outerHTML = l;
                                }
                            } else {
                                linhas += l;
                            }
                        })
                        document.querySelector('#setores_table tbody').insertAdjacentHTML('afterbegin', linhas);
                    }

                });
            }), (error) => {
                console.log("Erro ao buscar documentos: ", error);
            }
            if (JSON.parse(sessionStorage.getItem('usuario_logado')).credencial == '3') {
                db.collection('users').get()
                    .then((querySnapshot) => {
                        if (querySnapshot.empty) {
                            console.log("Nenhum usu√°rio encontrado.");
                            return;
                        }
                        let linhas = '';
                        querySnapshot.forEach((doc) => {
                            const dados = doc.data();
                            const celulas = [doc.id, dados.nome, dados.credencial, dados.senha];
                            linhas += criar_linha('usu√°rios', celulas);
                        });
                        document.querySelector('#usu√°rios tbody').insertAdjacentHTML('afterbegin', linhas);
                    })
                    .catch((error) => {
                        console.error("Erro ao buscar usu√°rios:", error);
                    });
            }
        }

        function escaparHTML(text) {
            return String(text)
                .replace(/&/g, '&amp;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }

        function criar_linha(aba, dados) {
            let linha;
            let copiado;
            if (localStorage.getItem('copiados')?.includes(dados[0])) {
                copiado = 'copiar_clicado';
            } else {
                copiado = 'copiar';
            }
            let borracha = '';
            let content_editable = false;
            if (!dados[0].toString().includes('-**-') || (aba != 'usu√°rios' && (dados[0].split('-**-')[0] == JSON.parse(sessionStorage.getItem('usuario_logado')).nome || JSON.parse(sessionStorage.getItem('usuario_logado')).credencial != '1'))) {
                borracha = `<svg class="borracha" onclick="excluir_linha(this,false)" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="17px" height="17px" viewBox="0 0 15 15" version="1.1">
                            <g id="surface1">
                                <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;" d="M 3.28125 12.65625 L 14.0625 12.65625 L 14.0625 13.59375 L 3.28125 13.59375 Z M 3.28125 12.65625 "/>
                                <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;" d="M 12.835938 4.925781 L 9.117188 1.214844 C 8.941406 1.039062 8.703125 0.9375 8.453125 0.9375 C 8.207031 0.9375 7.964844 1.039062 7.789062 1.214844 L 1.226562 7.777344 C 1.050781 7.953125 0.953125 8.191406 0.953125 8.441406 C 0.953125 8.6875 1.050781 8.925781 1.226562 9.101562 L 3.34375 11.25 L 7.835938 11.25 L 12.835938 6.253906 C 13.011719 6.078125 13.109375 5.839844 13.109375 5.589844 C 13.109375 5.339844 13.011719 5.101562 12.835938 4.925781 Z M 7.449219 10.3125 L 3.75 10.3125 L 1.875 8.4375 L 4.832031 5.480469 L 8.550781 9.191406 Z M 9.210938 8.550781 L 5.5 4.832031 L 8.4375 1.875 L 12.1875 5.59375 Z M 9.210938 8.550781 "/>
                            </g>
                        </svg>`;
                content_editable = true;
            }
            if (aba == 'rotinas') {
                linha = `<tr name="${dados[0]}" >
                <td style="width: 10px;" dados="${escaparHTML(dados[1])}-()-${escaparHTML(dados[2])}-()-${escaparHTML(dados[3])}-()-${escaparHTML(dados[4])}-()-${escaparHTML(dados[5])}-()-_QRA_-()-_QTR_INICIAL_-()-_QRU_-()-_QTR_FINAL_-()-${escaparHTML(dados[10])}-()-${escaparHTML(dados[11])}" >
                    <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                        <label class="checkbox-wrapper">
                                <input type="checkbox" class="custom-checkbox">
                                <span class="checkmark"></span>
                            </label>
                        <svg class="${copiado}" onclick="copiar_dados(this,false)" xmlns="http://www.w3.org/2000/svg" height="15px" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                        </svg> 
                        ${borracha}
                    </span>
                </td>
                <td oninput="filterOptions(this,0)"  onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}" onkeydown="teclas_atalho(this,event.key)">
                    ${dados[6]}
                </td>
                <td oninput="filterOptions(this,1)"  onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                    onkeydown="teclas_atalho(this,event.key)">
                    ${dados[8]}
                </td>
                <td oninput="filterOptions(this,2)"  onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                    onkeydown="teclas_atalho(this,event.key)">
                    ${dados[1]}
                </td>
                <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                    ${dados[4]}
                </td>
                <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                    ${dados[7]}
                </td>
                <td oninput="filterOptions(this,3)" onfocus="horario_final(this)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                    ${dados[9]}
                </td>
                <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                    ${dados[12] || ''}
                </td>
            </tr>`;
            } else if (aba == 'chamadas') {

                linha = `<tr name="${dados[0]}">
                    <td style="width: 10px;">
                        <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                            <svg class="${copiado}" onclick="copiar_dados(this,false)" xmlns="http://www.w3.org/2000/svg" height="18px"
                                width="18px" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                            </svg>

                            <svg class="empenhar" onclick="empenhar_gu(this)" xmlns="http://www.w3.org/2000/svg"
                                xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px"
                                viewBox="0 0 20 20" version="1.1">
                                <g id="surface1">
                                    <path style=" stroke:none;fill-rule:nonzero;fill-opacity:1;"
                                        d="M 4.765625 1.308594 C 4.167969 1.441406 3.535156 1.882812 3.210938 2.394531 C 3.003906 2.71875 2.96875 2.832031 2.1875 5.4375 L 1.511719 7.691406 L 1.253906 7.839844 C 0.738281 8.136719 0.289062 8.699219 0.105469 9.277344 C 0.0195312 9.550781 0.0195312 9.5625 0.0195312 12.441406 L 0.0195312 15.332031 L 0.109375 15.507812 C 0.15625 15.605469 0.246094 15.75 0.308594 15.824219 C 0.453125 15.996094 0.820312 16.195312 1.0625 16.230469 L 1.242188 16.257812 L 1.257812 17.046875 C 1.269531 17.761719 1.277344 17.847656 1.359375 18.007812 C 1.496094 18.285156 1.652344 18.453125 1.921875 18.597656 L 2.167969 18.730469 L 4.082031 18.730469 L 4.328125 18.597656 C 4.601562 18.449219 4.71875 18.328125 4.875 18.03125 C 4.976562 17.835938 4.980469 17.808594 4.992188 17.039062 L 5.007812 16.25 L 15 16.25 L 15 16.96875 C 15 17.523438 15.015625 17.730469 15.0625 17.882812 C 15.160156 18.179688 15.371094 18.429688 15.664062 18.589844 L 15.917969 18.730469 L 17.832031 18.730469 L 18.078125 18.597656 C 18.351562 18.449219 18.46875 18.328125 18.625 18.03125 C 18.726562 17.835938 18.730469 17.808594 18.742188 17.046875 L 18.757812 16.257812 L 18.9375 16.230469 C 19.167969 16.195312 19.542969 16 19.671875 15.847656 C 19.726562 15.785156 19.816406 15.640625 19.875 15.53125 L 19.980469 15.332031 L 19.980469 12.441406 C 19.980469 9.5625 19.980469 9.550781 19.894531 9.277344 C 19.710938 8.699219 19.261719 8.136719 18.746094 7.839844 L 18.488281 7.691406 L 17.8125 5.4375 C 17.441406 4.199219 17.09375 3.058594 17.039062 2.910156 C 16.785156 2.191406 16.222656 1.640625 15.484375 1.378906 L 15.175781 1.269531 L 10.097656 1.261719 C 5.859375 1.257812 4.976562 1.265625 4.765625 1.308594 Z M 15.257812 5.625 C 15.566406 6.644531 15.816406 7.484375 15.820312 7.488281 C 15.820312 7.496094 13.199219 7.5 9.996094 7.5 C 5.199219 7.5 4.175781 7.492188 4.191406 7.449219 C 4.203125 7.421875 4.453125 6.589844 4.746094 5.601562 C 5.042969 4.617188 5.292969 3.796875 5.300781 3.777344 C 5.308594 3.761719 7.429688 3.753906 10.007812 3.757812 L 14.699219 3.769531 Z M 5.511719 10.738281 C 5.78125 10.867188 5.949219 11.027344 6.097656 11.296875 C 6.21875 11.523438 6.230469 11.570312 6.230469 11.875 C 6.230469 12.179688 6.21875 12.226562 6.097656 12.453125 C 5.949219 12.726562 5.824219 12.84375 5.53125 13 C 5.363281 13.085938 5.28125 13.101562 5 13.101562 C 4.695312 13.105469 4.648438 13.09375 4.421875 12.972656 C 4.152344 12.828125 3.996094 12.660156 3.859375 12.382812 C 3.734375 12.125 3.738281 11.617188 3.867188 11.347656 C 4.03125 11.011719 4.347656 10.753906 4.707031 10.660156 C 4.898438 10.609375 5.324219 10.652344 5.511719 10.738281 Z M 15.511719 10.738281 C 15.78125 10.867188 15.949219 11.027344 16.097656 11.296875 C 16.21875 11.523438 16.230469 11.570312 16.230469 11.875 C 16.230469 12.179688 16.21875 12.226562 16.097656 12.453125 C 15.949219 12.726562 15.824219 12.84375 15.53125 13 C 15.363281 13.085938 15.28125 13.101562 15 13.101562 C 14.695312 13.105469 14.648438 13.09375 14.421875 12.972656 C 14.152344 12.828125 13.996094 12.660156 13.859375 12.382812 C 13.734375 12.125 13.738281 11.617188 13.867188 11.347656 C 14.03125 11.011719 14.347656 10.753906 14.707031 10.660156 C 14.898438 10.609375 15.324219 10.652344 15.511719 10.738281 Z M 15.511719 10.738281 " />
                                </g>
                            </svg>
                            ${borracha}
                        </span>
                    </td>
                    <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                        ${dados[1]}
                    </td>
                    <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                        ${dados[2]}
                    </td>
                    <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                        ${dados[3]}
                    </td>
                    <td oninput="filterOptions(this,4)" 
                        onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                        onkeydown="teclas_atalho(this,event.key)">
                        ${dados[4]}
                    </td>
                   <td oninput="filterOptions(this,2)" 
                        onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                        onkeydown="teclas_atalho(this,event.key)">
                        ${dados[5]}
                    </td>
                    <td oninput="filterOptions(this,5)" 
                        onblur="enviar_dados(this),hideOptions(event, this)" onfocus="atendente(this)" contenteditable="${content_editable}"
                        onkeydown="teclas_atalho(this,event.key)">
                        ${dados[6]}
                    </td>
                    <td oninput="filterOptions(this,6)" 
                        onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                        onkeydown="teclas_atalho(this,event.key)">
                        ${dados[7]}
                    </td>
                    <td oninput="filterOptions(this,7)" 
                        onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                        onkeydown="teclas_atalho(this,event.key)">
                        ${dados[8]}
                    </td>
                    <td oninput="filterOptions(this,3)" onfocus="horario_final(this)" contenteditable="${content_editable}"
                        onblur="enviar_dados(this)">
                        ${dados[9]}
                    </td>
                </tr>`
            } else if (aba == 'setores') {
                linha = `<tr name="${dados[0]}">
                    <td style="width: 10px;">
                        <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                            ${borracha}
                        </span>
                    </td>
                    <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                        ${dados[1]}
                    </td>
                    <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                        ${dados[4]}
                    </td>
                    <td oninput="filterOptions(this,8)" 
                        onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                        onkeydown="teclas_atalho(this,event.key)">
                        ${dados[2]}
                    </td>
                    <td oninput="filterOptions(this,4)" 
                        onblur="enviar_dados(this),hideOptions(event, this)" contenteditable="${content_editable}"
                        onkeydown="teclas_atalho(this,event.key)">
                        ${dados[5]}
                    </td>
                    <td oninput="filterOptions(this,3)" contenteditable="${content_editable}" onblur="enviar_dados(this)">
                        ${dados[3] || ''}
                    </td>
                </tr>`;
            } else if (aba == 'usu√°rios') {
                linha = `<tr>
                    <td style="width: 10px;">
                        <span class="icon-wrapper" style="display: inline-flex; gap: 4px; align-items: center;">
                            ${borracha}
                        </span>
                    </td>
                    <td oninput="filterOptions(this,3)" onblur="enviar_dados(this)" contenteditable="${content_editable}">
                        ${dados[0]}
                    </td>
                    <td oninput="filterOptions(this,3)" onblur="enviar_dados(this)" contenteditable="${content_editable}">
                        ${dados[1]}
                    </td>
                    <td oninput="filterOptions(this,3)" onblur="enviar_dados(this)" contenteditable="${content_editable}">
                        ${dados[2]}
                    </td>
                    <td oninput="filterOptions(this,3)" onblur="enviar_dados(this)" contenteditable="${content_editable}">
                        ${dados[3].substring(0, 4)}
                    </td>
                </tr>`;
            } else if (aba == 'equipes') {
                linha = `<tr name="${dados[0]}">
                    <td>
                    </td>
                    <td>
                        ${new Date(parseInt(dados[0])).toLocaleString('pt-BR', {
                    timeZone: 'America/Sao_Paulo',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                })}
                    </td>
                    <td>
                        ${dados[1]}
                    </td>
                    <td>
                        ${dados[3]}
                    </td>
                    <td>
                        ${dados[4]}
                    </td>
                    <td>
                        ${dados[5]}
                    </td>
                </tr>`;
            }
            return linha;
        }

        let tdComFoco = null;

        // Quando um <td> ganha foco
        document.addEventListener('focusin', (e) => {
            if (e.target.tagName === 'TD') {
                tdComFoco = e.target.closest('tr').getAttribute('name');
            }
        });

        let unsubscribeRotinasList = [];
        let unsubscribeChamadasList = [];
        let unsubscribeEquipesList = [];

        function filtrar_dados(aba) {
            let partes_inicial, data_inicial, partes_final, cad_norte, cad_sul, cad_centro, cad_especializadas, th;

            if (aba == 'rotinas') {
                const select_tipo_periodo = parseInt(document.querySelector('#select_tipo_periodo').value);
                const num_periodo_relativo = parseInt(document.querySelector('#num_periodo_relativo').value);
                let l_rotinas = document.querySelectorAll('#rotinas_table tbody tr');
                for (let index = 0; index < l_rotinas.length - 1; index++) {
                    l_rotinas[index].remove();

                }
                if (!document.querySelector('#rotina_data_inicial').getAttribute('readonly')) {
                    data_inicial = new Date(document.querySelector('#rotina_data_inicial').value);
                    data_inicial.setHours(0, 0, 0, 0);
                    data_final = new Date(document.querySelector('#rotina_data_final').value);
                    data_final.setHours(0, 0, 0, 0);
                } else {
                    data_inicial = new Date();
                    data_inicial.setMinutes(data_inicial.getMinutes() - (num_periodo_relativo * select_tipo_periodo));
                    data_inicial.setHours(0, 0, 0, 0);
                    data_final = new Date();
                    data_final.setHours(0, 0, 0, 0);
                }
                cad_norte = document.querySelector('#rotina_checkbox_norte');
                cad_sul = document.querySelector('#rotina_checkbox_sul');
                cad_centro = document.querySelector('#rotina_checkbox_centro');
                cad_especializadas = document.querySelector('#rotina_checkbox_especializadas');
                if (data_inicial == '' || data_final == '' || 0 <= data_final - data_inicial >= 3 || (cad_norte.checked == false && cad_sul.checked == false && cad_centro.checked == false && cad_especializadas.checked == false)) {
                    return;
                }
                guardar_filtro('rotinas');


                unsubscribeRotinasList.forEach(unsub => unsub());
                unsubscribeRotinasList = [];
                // lista de unsubscribers

                // Suponha que voc√™ j√° tenha: data_inicial e data_final
                let current = new Date(data_inicial);
                while (current <= data_final) {
                    const dataStr = current.toISOString();

                    const unsub = db.collection('rotinas').doc(dataStr).onSnapshot(doc => {

                        if (!doc.exists) { return };
                        const dados = doc.data();
                        let linhas = '';
                        document.querySelectorAll('#rotinas_table tbody tr').forEach(linha => {
                            let data_linha = new Date(linha.querySelectorAll('td')[5].innerText.split('/')[2]?.split(',')[0], linha.querySelectorAll('td')[5].innerText.split('/')[1] - 1, linha.querySelectorAll('td')[5].innerText.split('/')[0]);
                            if (!isNaN(data_linha.getTime())) {
                                data_linha = data_linha.toISOString();
                            }
                            if (!JSON.stringify(dados).includes(linha.getAttribute('name')) && linha.querySelectorAll('td')[5].innerText !== '' && dataStr == data_linha) {
                                linha.remove();
                            }
                        });

                        const setores = ['norte', 'sul', 'centro', 'especializadas'];
                        setores.forEach(setor => {
                            const checkbox = document.querySelector(`#rotina_checkbox_${setor}`);
                            if (checkbox?.checked && dados[setor]) {
                                dados[setor].split('-++-').forEach(linha => {
                                    if (!linha) return;
                                    const celulas = linha.split('-()-');
                                    let datahorafinal_filtro, data_inicial_filtro, datahora_linha;
                                    const partes_datahora = celulas[7].split(/\/|, |:/);
                                    datahora_linha = new Date(parseInt(partes_datahora[2]), parseInt(partes_datahora[1]) - 1, parseInt(partes_datahora[0]), parseInt(partes_datahora[3]), parseInt(partes_datahora[4]));
                                    if (!document.querySelector('#rotina_data_inicial').getAttribute('readonly')) {
                                        data_inicial_filtro = new Date(document.querySelector('#rotina_data_inicial').value);
                                        datahorafinal_filtro = new Date(document.querySelector('#rotina_data_final').value);
                                    } else {
                                        datahorafinal_filtro = new Date();
                                        data_inicial_filtro = new Date();
                                        data_inicial_filtro.setMinutes(data_inicial_filtro.getMinutes() - (num_periodo_relativo * select_tipo_periodo));
                                    }
                                    if (data_inicial_filtro <= datahora_linha && datahora_linha <= datahorafinal_filtro) {
                                        const l = criar_linha('rotinas', celulas);
                                        if (document.querySelector(`#rotinas_table tr[name='${celulas[0]}']`)) {
                                            let marcado = document.querySelector(`#rotinas_table tr[name='${celulas[0]}'] input[type=checkbox]`).checked;
                                            document.querySelector(`#rotinas_table tr[name='${celulas[0]}']`).outerHTML = l;
                                            document.querySelector(`#rotinas_table tr[name='${celulas[0]}'] input[type=checkbox]`).checked = marcado == true;
                                        } else {
                                            linhas += l;
                                        }
                                    }
                                });
                            }
                        });

                        document.querySelector('#rotinas_table tbody').insertAdjacentHTML('afterbegin', linhas);
                        th = document.querySelector('#rotinas_table th[asc],#rotinas_table th[desc]');
                        if (th) {
                            const index = Array.from(th.closest('thead').querySelectorAll('th')).indexOf(th);
                            let lin_tab = Array.from(th.closest('table').querySelectorAll('tbody tr')).map((l) => l.querySelectorAll('td')[index].innerText + '-&&-' + l.outerHTML + '-&&-' + l.querySelector('input[type=checkbox]').checked);
                            lin_tab.pop();
                            if (th.getAttribute('asc')) {
                                lin_tab.sort().reverse();
                            } else {
                                lin_tab.sort();
                            }
                            th.closest('table').querySelector('tbody').innerHTML = th.closest('table').querySelector('tbody tr:last-child').outerHTML;
                            lin_tab.forEach(l => {
                                th.closest('table').querySelector('tbody tr:last-child').insertAdjacentHTML('beforebegin', l.split('-&&-')[1]);
                                th.closest('table').querySelector('tbody tr:last-child').previousElementSibling.querySelector('input[type=checkbox]').checked = l.split('-&&-')[2] == 'true';
                            });
                            if (tdComFoco && document.querySelectorAll(`tr[name="${tdComFoco}"] td`)[1]) {
                                document.querySelectorAll(`tr[name="${tdComFoco}"] td`)[1].focus();
                            }
                            window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
                        }
                    });

                    unsubscribeRotinasList.push(unsub); // salvar fun√ß√£o para limpar depois
                    current.setDate(current.getDate() + 1);
                }


            } else if (aba == 'chamadas') {
                let l_chamadas = document.querySelectorAll('#chamadas_table tbody tr');
                for (let index = 0; index < l_chamadas.length - 1; index++) {
                    l_chamadas[index].remove();

                }
                data_inicial = new Date(document.querySelector('#chamadas_data_inicial').value);
                data_inicial.setHours(0, 0, 0, 0);
                data_final = new Date(document.querySelector('#chamadas_data_final').value);
                data_final.setHours(0, 0, 0, 0);
                if (data_inicial == '' || data_final == '' || 0 <= data_final - data_inicial >= 3) {
                    return;
                }
                guardar_filtro('chamadas');


                unsubscribeChamadasList.forEach(unsub => unsub());
                unsubscribeChamadasList = [];
                // lista de unsubscribers

                // Suponha que voc√™ j√° tenha: data_inicial e data_final
                let current = new Date(data_inicial);

                while (current <= data_final) {
                    const dataStr = current.toISOString();

                    const unsub = db.collection('chamadas').doc(dataStr).onSnapshot(doc => {
                        if (!doc.exists) { return };
                        const dados = doc.data();

                        let linhas = '';
                        document.querySelectorAll('#chamadas_table tbody tr').forEach(linha => {
                            let data_linha = new Date(linha.querySelectorAll('td')[9].innerText.split('/')[2]?.split(',')[0], linha.querySelectorAll('td')[9].innerText.split('/')[1] - 1, linha.querySelectorAll('td')[9].innerText.split('/')[0]);
                            if (!isNaN(data_linha.getTime())) {
                                data_linha = data_linha.toISOString();
                            }
                            if (!JSON.stringify(dados).includes(linha.getAttribute('name')) && linha.querySelectorAll('td')[9].innerText !== '' && dataStr == data_linha) {
                                linha.remove();
                            }
                        });

                        dados.chamadas.split('-++-').forEach(linha => {
                            if (!linha) return;
                            const celulas = linha.split('-()-'); //9

                            const partes_datahora = celulas[9].split(/\/|, |:/);
                            const datahora_linha = new Date(parseInt(partes_datahora[2]), parseInt(partes_datahora[1]) - 1, parseInt(partes_datahora[0]), parseInt(partes_datahora[3]), parseInt(partes_datahora[4]));
                            if (new Date(document.querySelector('#chamadas_data_inicial').value) <= datahora_linha && datahora_linha <= new Date(document.querySelector('#chamadas_data_final').value)) {
                                const l = criar_linha('chamadas', celulas);
                                if (document.querySelector(`#chamadas_table tr[name='${celulas[0]}']`)) {
                                    document.querySelector(`#chamadas_table tr[name='${celulas[0]}']`).outerHTML = l;
                                } else {
                                    linhas += l;
                                }
                            }
                        });



                        document.querySelector('#chamadas_table tbody').insertAdjacentHTML('afterbegin', linhas);
                        window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
                        th = document.querySelector('#chamadas_table th[asc],#chamadas_table th[desc]');
                        if (th) {
                            const index = Array.from(th.closest('thead').querySelectorAll('th')).indexOf(th);
                            let lin_tab = Array.from(th.closest('table').querySelectorAll('tbody tr')).map((l) => l.querySelectorAll('td')[index].innerText + '-&&-' + l.outerHTML);
                            lin_tab.pop();
                            if (th.getAttribute('asc')) {
                                lin_tab.sort().reverse();
                            } else {
                                lin_tab.sort();
                            }
                            th.closest('table').querySelector('tbody').innerHTML = th.closest('table').querySelector('tbody tr:last-child').outerHTML;
                            lin_tab = lin_tab.map((l) => l.split('-&&-')[1]).forEach(l => {
                                th.closest('table').querySelector('tbody tr:last-child').insertAdjacentHTML('beforebegin', l);
                            });
                            window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
                        }
                        const resumo_chamadas = document.querySelectorAll('#resumo_chamadas tbody td');
                        let denuncias_153 = 0;
                        let denuncias_wats = 0;
                        let total_ligacoes = 0;
                        let apoio_ao_samu = 0;

                        document.querySelectorAll('#chamadas_table tbody tr').forEach(tr => {
                            let celulas = tr.querySelectorAll('td');
                            if ((celulas[8].innerText.includes('153') || celulas[8].innerText.includes('156')) && !celulas[8].innerText.includes('WhatsApp')) {
                                denuncias_153++;
                                total_ligacoes++;
                            }
                            if (celulas[8].innerText.includes('WhatsApp 153')) {
                                denuncias_wats++;
                            }
                            if (celulas[8].innerText.includes('5161')) {
                                total_ligacoes++;
                            }
                            if (celulas[4].innerText.toLowerCase().includes('samu')) {
                                apoio_ao_samu++;
                            }
                            resumo_chamadas[0].innerText = denuncias_153;
                            resumo_chamadas[1].innerText = denuncias_wats;
                            resumo_chamadas[2].innerText = total_ligacoes;
                            resumo_chamadas[3].innerText = apoio_ao_samu;

                        })

                    });

                    unsubscribeChamadasList.push(unsub); // salvar fun√ß√£o para limpar depois
                    current.setDate(current.getDate() + 1);
                }
            } else if (aba == 'setores') {
                const filtros = Array.from(document.querySelectorAll('#filtro_setores input'));
                const linhas = document.querySelectorAll('#setores_table tbody tr');

                function filtrarTabela() {
                    linhas.forEach(linha => {
                        const colunas = linha.querySelectorAll('td');

                        if (linha.innerText.trim() === '') {
                            linha.style.display = '';
                            return;
                        }

                        const corresponde = filtros.every((filtro, i) => {
                            const textoFiltro = filtro.value.trim().toLowerCase();
                            const textoCelula = colunas[i + 1]?.innerText.trim().toLowerCase() || '';
                            return textoCelula.includes(textoFiltro);
                        });

                        linha.style.display = corresponde ? '' : 'none';
                    });
                }

                const filtrarComDelay = debounce(filtrarTabela, 200);

                // Adiciona evento nos inputs com debounce
                filtros.forEach(input => {
                    input.addEventListener('input', filtrarComDelay);
                });
            } else if (aba == 'equipes') {
                let l_equipes = document.querySelectorAll('#equipes_table tbody tr');
                for (let index = 0; index < l_equipes.length; index++) {
                    l_equipes[index].remove();

                }
                data_inicial = new Date(document.querySelector('#equipes_data_inicial').value);
                data_inicial.setHours(0, 0, 0, 0);
                data_final = new Date(document.querySelector('#equipes_data_final').value);
                data_final.setHours(0, 0, 0, 0);
                if (data_inicial == '' || data_final == '' || 0 <= data_final - data_inicial >= 3) {
                    return;
                }
                guardar_filtro('equipes');


                unsubscribeEquipesList.forEach(unsub => unsub());
                unsubscribeEquipesList = [];
                // lista de unsubscribers

                // Suponha que voc√™ j√° tenha: data_inicial e data_final
                let current = new Date(data_inicial);

                while (current <= data_final) {
                    const dataStr = current.toISOString();

                    const unsub = db.collection('equipes').doc(dataStr).onSnapshot(doc => {
                        if (!doc.exists) { return };
                        document.querySelector('#equipes_table tbody').innerHTML = '';
                        const dados = Object.entries(doc.data());

                        let linhas = '';

                        for (const [campoId, linha] of dados) {
                            if (!linha) return;
                            let celulas = linha.split('-()-');

                            const datahora_linha = new Date(parseInt(campoId));
                            celulas.unshift(campoId);

                            if (new Date(document.querySelector('#equipes_data_inicial').value) <= datahora_linha && datahora_linha <= new Date(document.querySelector('#equipes_data_final').value)) {
                                if (celulas[3].includes('-++-')) {
                                    const pessoas = celulas[3].split(',');
                                    pessoas.forEach((pessoa) => {
                                        const gms = JSON.parse(localStorage.getItem('gms')).gms.split('-');

                                        let l = [celulas[0], celulas[1], 'Agente', gms.find(item => item.toUpperCase().startsWith(pessoa.split('-++-')[0].toUpperCase())), pessoa.split('-++-')[1], celulas[2]];
                                        l = criar_linha('equipes', l);
                                        linhas += l;
                                    })
                                } else {
                                    const equipamentos = celulas[3].split(',');
                                    equipamentos.forEach((equipamentos) => {
                                        let l = [celulas[0], celulas[1], 'Equipamento', equipamentos.split(' - ')[1], equipamentos.split(' - ')[0], celulas[2]];
                                        l = criar_linha('equipes', l);
                                        linhas += l;
                                    })
                                }



                            }
                        }
                        document.querySelector('#equipes_table tbody').insertAdjacentHTML('afterbegin', linhas);
                        document.querySelectorAll('#filtro_equipes input[type="checkbox"]:not([value="Todas"])').forEach(input => {
                            input.checked = input.checked == true;
                            input.dispatchEvent(new Event('input', { bubbles: true }));
                        })

                        window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
                        th = document.querySelector('#equipes_table th[asc],#equipes_table th[desc]');
                        if (th) {
                            const index = Array.from(th.closest('thead').querySelectorAll('th')).indexOf(th);
                            let lin_tab = Array.from(th.closest('table').querySelectorAll('tbody tr')).map((l) => l.querySelectorAll('td')[index].innerText + '-&&-' + l.outerHTML);
                            if (th.getAttribute('asc')) {
                                lin_tab.sort().reverse();
                            } else {
                                lin_tab.sort();
                            }
                            th.closest('table').querySelector('tbody').innerHTML = '';
                            lin_tab = lin_tab.map((l) => l.split('-&&-')[1]).forEach(l => {
                                th.closest('table').querySelector('tbody').insertAdjacentHTML('afterbegin', l);
                            });
                            window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
                        }

                    });

                    unsubscribeEquipesList.push(unsub); // salvar fun√ß√£o para limpar depois
                    current.setDate(current.getDate() + 1);
                }
            }

            return true;
        }

        function debounce(func, delay) {
            let timeout;
            return function () {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, arguments), delay);
            };
        }

        const optionsList = document.querySelector('#options-list');

        function showOptions(td, list) {
            const rect = td.getBoundingClientRect();
            const itemHeight = 40;
            const buffer = 10;
            const maxHeight = 400;

            const totalItems = optionsList.querySelectorAll('li').length;
            const totalHeight = totalItems * itemHeight;
            const menuHeight = Math.min(totalHeight, maxHeight);

            let top;
            // Verifica se h√° espa√ßo suficiente abaixo da c√©lula
            const enoughSpaceBelow = rect.bottom + menuHeight + buffer <= window.innerHeight;

            if (enoughSpaceBelow) {
                // Mostrar abaixo da c√©lula
                top = rect.bottom + window.scrollY + buffer;
            } else {
                // Mostrar acima, mas colado na c√©lula (n√£o depende da altura do menu)
                // S√≥ subtrai o menuHeight agora (corrige o comportamento anterior)
                top = rect.top + window.scrollY - menuHeight - buffer;

                // Garante que n√£o ultrapasse o topo da tela (ajuste opcional)
                const minTop = 10 + window.scrollY;
                if (top < minTop) {
                    const ajuste = rect.top + window.scrollY - minTop - buffer;
                    const alturaAjustada = Math.min(menuHeight, ajuste);
                    top = minTop;
                    optionsList.style.maxHeight = `${alturaAjustada}px`;
                } else {
                    optionsList.style.maxHeight = `${menuHeight}px`;
                }
            }

            // Aplica estilos
            optionsList.style.top = `${top}px`;
            optionsList.style.left = `${rect.left + window.scrollX}px`;
            optionsList.style.width = `${rect.width}px`;
            optionsList.style.display = "block";
            optionsList.dataset.targetId = td.dataset.id;
            optionsList.targetTd = td;

        }


        function hideOptions(event, td) {
            const aba = document.querySelector('button[class="tab-button ativo"]').innerText.toLowerCase();
            let options = optionsList.innerHTML;
            setTimeout(() => { // delay para permitir clique
                if (optionsList.innerHTML == options) {
                    optionsList.style.display = "none";
                }
            }, 200);
            let celulas = td.parentNode.querySelectorAll('td');
            let celulas_vazias = 'sim';
            celulas.forEach(l => {
                if (l.innerText != '' && l.innerHTML != '<br>') {
                    celulas_vazias = 'nao';
                }
            })

            if (celulas_vazias == 'sim' && td.parentNode.parentNode.querySelectorAll('tr').length > 1 && td.parentNode != td.parentNode.parentNode.querySelectorAll('tr')[td.parentNode.parentNode.querySelectorAll('tr').length - 1]) {
                td.parentNode.remove();
            }
            if (td == td.parentNode.querySelectorAll('td')[3] && optionsList.style.display == "none" && aba == 'rotinas') {
                td.parentNode.nextElementSibling?.querySelectorAll('td')[1]?.focus();
            }
        }

        function filterOptions(td, list) {
            const aba = document.querySelector('button[class="tab-button ativo"]').innerText.toLowerCase();
            let celulas = td.parentNode.querySelectorAll('td');

            if (aba == 'rotinas' || aba == 'chamadas') {
                let registros_locais = JSON.parse(localStorage.getItem('registros_locais') || '{}');
                registros_locais[`${aba}--${td.parentNode.getAttribute('name')}`] = td.parentNode.outerHTML;
                localStorage.setItem('registros_locais', JSON.stringify(registros_locais));
            }



            let vazia = '';
            const table = document.querySelector(`#${document.querySelector('button[class="tab-button ativo"]').innerText.toLowerCase()}_table tbody`);
            table.querySelectorAll('tr')[table.querySelectorAll('tr').length - 1].querySelectorAll('td').forEach(function (item) {
                if (item.innerText != '') {
                    vazia = 'nao';
                }
            });

            celulas.forEach(function (cel) {
                if (cel.innerText != '' && vazia == 'nao') {
                    if (aba != 'usu√°rios') {
                        table.insertAdjacentHTML('beforeend', criar_linha(aba, [JSON.parse(sessionStorage.getItem('usuario_logado')).nome + '-**-' + new Date().getTime(), '', '', '', '', '', '', '', '', '', '', '']));
                    } else {
                        table.insertAdjacentHTML('beforeend', criar_linha(aba, ['', '', '', '', '']));
                    }

                    td.focus();
                    vazia = '';
                }

            });
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: "smooth"
            });

            const text = td.innerText.trim().toLowerCase();

            if (td == td.parentNode.querySelectorAll('td')[4] && aba == 'Rotinas') {
                let dados = td.parentNode.querySelectorAll('td')[0].getAttribute('dados').split('-()-');
                dados[3] = td.innerText.trim();
                td.parentNode.querySelectorAll('td')[0].setAttribute('dados', dados.join('-()-'));
            }
            updateOptions(td, text, list);
            showOptions(td, list);

        }

        function updateOptions(td, filter, list) {
            let options = [];
            if (list == 0) {
                JSON.parse(localStorage.getItem('gus')).gus.split('-').forEach(function (item) {
                    options.push(item + ' - Dia');
                    options.push(item + ' - Noite');
                });
            } else if (list == 1) {
                options = JSON.parse(localStorage.getItem('qru')).qru.split('-').sort();
            } else if (list == 2) {
                JSON.parse(localStorage.getItem('qth')).qth.split('-++-').forEach(function (item) {
                    if (item != '' && item.split('-()-')[1].replaceAll('"', '').trim() != '') {
                        options.push(item.split('-()-')[1].replaceAll('"', '').trim());
                        if (item.split('-()-')[1].replaceAll('"', '').trim().toLowerCase() == filter && document.querySelector('button[class="tab-button ativo"]').innerText == 'Rotinas') {
                            td.nextElementSibling.innerText = item.split('-()-')[4].replaceAll('"', '').trim();
                            td.parentNode.querySelector('td').setAttribute('dados', item.replace(item.substring(0, item.indexOf('-()-') + 4), '').replaceAll('"', '').trim());
                        }
                    }
                });
            } else if (list == 4) {
                options = JSON.parse(localStorage.getItem('naturezas')).naturezas.split('-').sort();
            } else if (list == 5) {
                options = JSON.parse(localStorage.getItem('gms')).gms.split('-').sort();
            } else if (list == 6) {
                options = JSON.parse(localStorage.getItem('area')).area.split('-').sort();
            } else if (list == 7) {
                options = JSON.parse(localStorage.getItem('meio')).meio.split('-').sort();
            } else if (list == 8) {
                options = JSON.parse(localStorage.getItem('tipo')).tipo.split('-').sort();
            }
            options = options.sort();
            optionsList.innerHTML = "";
            options.filter(opt => opt.toLowerCase().includes(filter)).forEach(opt => {
                const li = document.createElement("li");
                li.textContent = opt;
                li.style.padding = "5px";
                li.style.cursor = "pointer";
                li.onclick = () => {
                    optionsList.targetTd.innerText = opt;
                    optionsList.targetTd.focus();
                    optionsList.targetTd.dispatchEvent(new Event('input', { bubbles: true }));

                    optionsList.style.display = "none";
                };
                optionsList.appendChild(li);
            });
            optionsList.querySelector('li')?.classList.add('selecionado');
        }

        function horario_final(celula) {
            if (celula.innerText == '' || celula.innerText == '\n') {
                celula.innerText = new Date().toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false, // usa o formato 24h
                });
            }
        }

        function atendente(celula) {
            if (celula.innerText == '' || celula.innerText == '\n') {
                celula.innerText = `GM ${JSON.parse(sessionStorage.getItem('usuario_logado')).nome.toUpperCase()}`;
            }
        }


        function copiar_dados(celula, todos) {
            const celulas = celula.closest('tr').querySelectorAll('td');
            let texto = '';
            const aba = document.querySelector('button[class="tab-button ativo"]').innerText;
            if (aba == 'Rotinas' && celulas[0].getAttribute('dados')) {
                if (celulas[0].getAttribute('dados').includes('-()-_QRA_-()-_QTR_INICIAL_-()-_QRU_-()-_QTR_FINAL_-()-')) {
                    let qth = celulas[0].getAttribute('dados').split('-()-')[0];
                    let qth_certo = qth.replace('DEM ', '');
                    if (!localStorage.getItem('qth').includes(qth_certo)) {
                        qth_certo = '';
                    }
                    texto = `${celulas[0].getAttribute('dados').replace('_QRA_', celulas[1].innerText.trim()).replace('_QTR_INICIAL_', celulas[5].innerText.trim().replace(',', '')).replace('_QRU_', celulas[2].innerText.trim()).replace('_QTR_FINAL_', celulas[6].innerText.trim().replace(',', '')).replace(qth, qth_certo)}`;
                } else {
                    texto = `${celulas[0].getAttribute('dados')}-()-${celulas[1].innerText.trim()}-()-${celulas[5].innerText.trim()}-()-${celulas[2].innerText.trim()}-()-${celulas[6].innerText.trim()}-()--()-`;
                }
                if (!texto.includes('-++-')) {
                    texto += `-++-`;
                }
            } else if (aba == 'Chamadas') {
                let qth_endereco = celulas[5].innerText;
                if (localStorage.getItem('qth')?.includes(qth_endereco)) {
                    let qth = JSON.parse(localStorage.getItem('qth')).qth;
                    qth_endereco += ' - ' + qth.substring(qth.indexOf(qth_endereco), qth.indexOf('-++-', qth.indexOf(qth_endereco))).split('-()-')[3];
                }
                let samu = '';
                if (celulas[4].innerText.toLowerCase().includes('samu')) {
                    samu = '*Definir ponto de encontro e aguardar libera√ß√£o para deslocamento.*'
                }
                texto = `*Demanda via ${celulas[8].innerText}*
                
                    
*üö®ATIVAR AS C√ÇMERAS CORPORAISüö®*
                    
*Data-hora:* ${celulas[9].innerText}
                    
*Natureza:* ${celulas[4].innerText}
                    
*Situa√ß√£o:* ${celulas[3].innerText} 
                    
*Endere√ßo:*
${qth_endereco}
                    
*Contato denunciante:*
*Nome:* ${celulas[1].innerText}
*N√∫mero:* ${celulas[2].innerText}
                    
${samu}`
            }
            if (todos == true) {
                return texto;
            } else {
                navigator.clipboard.writeText(texto.replaceAll(`
                    `, '\n'));
                const msg = document.createElement('div');
                msg.className = 'copiado-msg';
                msg.innerText = 'Copiado!';

                // Garante que o SVG possa conter o elemento
                const wrapper = celula.parentElement;
                wrapper.style.position = 'relative';
                wrapper.appendChild(msg);

                setTimeout(() => msg.remove(), 1000);
            }


            celula.setAttribute('class', 'copiar_clicado');
            let copiados = localStorage.getItem('copiados') || '';
            copiados += celula.closest('tr').getAttribute('name')
            localStorage.setItem('copiados', copiados);
        }

        function teclas_atalho(celula, tecla) {
            let options = document.querySelectorAll('#options-list li');
            if (document.querySelector('ul').style.display == "block") {
                let selecionado = document.querySelector('li.selecionado');
                if (tecla == "ArrowDown" && options.length > 1 && Array.from(options).indexOf(document.querySelector('li.selecionado')) < options.length - 1) {
                    selecionado.classList.remove('selecionado');
                    selecionado.nextElementSibling?.classList.add('selecionado');
                    selecionado.nextElementSibling?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
                if (tecla == "ArrowUp" && options.length > 1 && Array.from(options).indexOf(document.querySelector('li.selecionado')) > 0) {
                    selecionado.classList.remove('selecionado');
                    selecionado.previousElementSibling?.classList.add('selecionado');
                    selecionado.previousElementSibling?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
                if (tecla == 'Tab' || tecla == 'Enter') {
                    event.preventDefault();
                    if (celula == 'senha') {
                        document.querySelector('#login button').click();
                    } else {
                        selecionado?.click();
                        celula.nextElementSibling?.click();
                        celula.nextElementSibling?.focus();
                    }
                }
                if (tecla == 'Escape') {
                    event.preventDefault();
                    document.querySelector('ul').style.display = "none";
                }
            }
            if (tecla == 'Enter' && celula == 'senha') {
                event.preventDefault();
                document.querySelector('#login button').click();
            }
            if (tecla == 'Enter' && celula == 'primeiro_acesso') {
                event.preventDefault();
                document.querySelector('#primeiro_acesso button').click();
            }

        }

        function selecionarAba(botao) {
            document.querySelector('#rotinas').style.display = 'none';
            document.querySelector('#chamadas').style.display = 'none';
            document.querySelector('#setores').style.display = 'none';
            document.querySelector('#equipes').style.display = 'none';
            document.querySelector('#usu√°rios').style.display = 'none';

            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('ativo');
            });
            botao.classList.add('ativo');
            if (botao.innerText == 'Rotinas') {
                document.querySelector('#rotinas').style.display = 'block';
            } else if (botao.innerText == 'Chamadas') {
                document.querySelector('#chamadas').style.display = 'block';
            } else if (botao.innerText == 'Setores') {
                document.querySelector('#setores').style.display = 'block';
            } else if (botao.innerText == 'Usu√°rios') {
                document.querySelector('#usu√°rios').style.display = 'block';
            } else if (botao.innerText == 'Equipes') {
                document.querySelector('#equipes').style.display = 'block';
            }
            localStorage.setItem('config_abas', botao.innerText);

        }

        function enviar_dados(td) {
            const aba = document.querySelector('button[class="tab-button ativo"]').innerText;
            let celulas = td.parentNode.querySelectorAll('td');
            let hora = new Date().toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false, // usa o formato 24h
            });
            if (document.querySelector('button[class="tab-button ativo"]').innerText == 'Rotinas' &&
                celulas[1].innerText != '' &&
                celulas[2].innerText != '' &&
                celulas[5].innerText == '' &&
                (celulas[3].innerText != '' || celulas[4].innerText != '')
            ) {
                // Preenche a c√©lula 5 com a hora atual
                const hora = new Date().toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false, // usa o formato 24h
                });
                celulas[5].innerText = hora;
            }

            if (aba == 'Rotinas' && (celulas[1].innerText == '' || celulas[2].innerText == '')) {
                return;
            } else if (aba == 'Chamadas' && (celulas[1].innerText == '' || celulas[3].innerText == '' || celulas[4].innerText == '' || celulas[5].innerText == '' || celulas[6].innerText == '' || celulas[7].innerText == '' || celulas[8].innerText == '' || celulas[9].innerText == '')) {
                return;
            } else if (aba == 'Setores' && (celulas[1].innerText == '' || celulas[2].innerText == '' || celulas[3].innerText == '' || celulas[4].innerText == '')) {
                return;
            } else if (aba == 'Usu√°rios' && (celulas[1].innerText == '' || celulas[2].innerText == '' || celulas[3].innerText == '')) {
                return;
            }
            let data = '';
            let newData = '';
            let interval_envio = setInterval(() => {
                if ((aba == 'Setores' && celulas[1].innerText != '' && celulas[2].innerText != '' && celulas[3].innerText != '' && celulas[4].innerText != '') || aba == 'Usu√°rios' || (celulas[1].innerText != '' && celulas[2].innerText != '' && (celulas[3].innerText != '' || celulas[4].innerText != '') && celulas[5].innerText != '')) {
                    clearInterval(interval_envio);
                    const cads_gu = ['6734', '2958', 'C', 'PAR'];
                    const cads_tipo = ['norte', 'sul', 'centro', 'especializadas'];
                    let cad = '';
                    for (let index = 0; index < cads_gu.length; index++) {
                        if (cads_gu[index].includes(celulas[1].innerText.substring(0, 1))) {
                            cad = cads_tipo[index];
                        }
                    }



                    if (aba == 'Rotinas') {
                        data = new Date(celulas[5].innerText.split(',')[0].split('/')[2], parseInt(celulas[5].innerText.split('/')[1]) - 1, celulas[5].innerText.split('/')[0]);

                        if (celulas[0].getAttribute('dados')?.includes('-()--()--()--()--()-_QRA_-()-_QTR_INICIAL_-()-_QRU_-()-_QTR_FINAL_-()--()-')) {
                            newData = `${celulas[0].parentNode.getAttribute('name')}-()-${celulas[3].innerText.trim() + '-()--()--()-' + celulas[4].innerText.trim() + '-()-'}-()-${celulas[1].innerText.trim()}-()-${celulas[5].innerText.trim()}-()-${celulas[2].innerText.trim()}-()-${celulas[6].innerText.trim()}-()--()--()-${celulas[7].innerText.trim()}-++-`;
                        } else if (celulas[0].getAttribute('dados')?.includes('-()-_QRA_-()-_QTR_INICIAL_-()-_QRU_-()-_QTR_FINAL_-()-')) {
                            newData = celulas[0].parentNode.getAttribute('name') + '-()-' + celulas[0].getAttribute('dados').replace('_QRA_', celulas[1].innerText.trim()).replace('_QTR_INICIAL_', celulas[5].innerText.trim()).replace('_QRU_', celulas[2].innerText.trim()).replace('_QTR_FINAL_', celulas[6].innerText.trim()) + '-()-' + celulas[7].innerText.trim() + '-++-';
                        } else {
                            newData = `${celulas[0].parentNode.getAttribute('name')}-()-${celulas[0].getAttribute('dados') || (celulas[3].innerText.trim() + '-()--()--()-' + celulas[4].innerText.trim() + '-()-')}-()-${celulas[1].innerText.trim()}-()-${celulas[5].innerText.trim()}-()-${celulas[2].innerText.trim()}-()-${celulas[6].innerText.trim()}-()--()--()-${celulas[7].innerText.trim()}-++-`;
                        }
                    } else if (aba == 'Chamadas') {
                        data = celulas[9].innerText.split(',')[0].split('/').map((d) => parseInt(d));
                        data = new Date(data[2], data[1] - 1, data[0]);

                        newData = `${td.parentNode.getAttribute('name')}-()-${celulas[1].innerText.trim()}-()-${celulas[2].innerText.trim()}-()-${celulas[3].innerText.trim()}-()-${celulas[4].innerText.trim()}-()-${celulas[5].innerText.trim() || ''}-()-${celulas[6].innerText.trim() || ''}-()-${celulas[7].innerText.trim() || ''}-()-${celulas[8].innerText.trim() || ''}-()-${celulas[9].innerText.trim()}-++-`;
                    } else if (aba == 'Setores') {
                        data = new Date(new Date(parseInt(td.parentNode.getAttribute('name'))).getFullYear(), new Date(parseInt(td.parentNode.getAttribute('name'))).getMonth(), new Date(parseInt(td.parentNode.getAttribute('name'))).getDate());
                        newData = `${td.parentNode.getAttribute('name')}-()-${celulas[1].innerText.trim()}-()-${celulas[3].innerText.trim()}-()-${celulas[5].innerText.trim()}-()-${celulas[2].innerText.trim()}-()-${celulas[4].innerText.trim() || ''}-++-`;
                    } else if (aba == 'Usu√°rios') {
                        data = celulas[1].innerText.trim();
                        let senha = '';
                        if (celulas[4].innerText != '' && celulas[4].innerText != '\n') {
                            senha = celulas[4].innerText
                        } else {
                            senha = CryptoJS.SHA256('12345').toString();
                        }
                        const userRef = db.collection('users').doc(data);

                        userRef.get().then((doc) => {
                            const novoUsuario = {
                                nome: celulas[2].innerText.trim(),
                                criado_em: firebase.firestore.FieldValue.serverTimestamp(),
                                credencial: celulas[3].innerText.trim()
                            };

                            // S√≥ define a senha se o documento ainda n√£o existir
                            if (!doc.exists || celulas[4].innerText == '' || celulas[4].innerText == '\n') {
                                novoUsuario.senha = senha;
                            }

                            userRef.set(novoUsuario, { merge: true }) // 'merge' evita sobrescrever campos n√£o especificados
                                .then(() => {
                                    console.log('Usu√°rio salvo com sucesso.');
                                })
                                .catch((error) => {
                                    console.error('Erro ao salvar usu√°rio:', error);
                                });
                        });
                    }
                    let ja_enviado = sessionStorage.getItem('ja_enviado' + aba) || '';
                    if (!ja_enviado.includes(newData)) {
                        let docRef = '';
                        if (aba == 'Rotinas' || aba == 'Chamadas') {
                            docRef = db.collection(aba.toLowerCase()).doc(data.toISOString());
                        } else {
                            docRef = db.collection('dados_fixos').doc('qth');
                        }
                        docRef.get().then((docSnapshot) => {

                            if (docSnapshot.exists) {
                                // Documento existe, vamos pegar os dados antigos
                                let existingData = docSnapshot.data();
                                if (!JSON.stringify(existingData).includes(td.parentNode.getAttribute('name'))) {
                                    if (aba == 'Rotinas') {
                                        existingData[cad] += newData;
                                    } else if (aba == 'Chamadas') {
                                        existingData['chamadas'] += newData;
                                    } else if (aba == 'Setores') {
                                        existingData['qth'] += newData;
                                    }
                                    sessionStorage.setItem('ja_enviado' + aba, JSON.stringify(existingData));
                                } else {
                                    let dado_antigo = JSON.stringify(existingData).substring(JSON.stringify(existingData).indexOf(td.parentNode.getAttribute('name'),)).substring(0, JSON.stringify(existingData).substring(JSON.stringify(existingData).indexOf(td.parentNode.getAttribute('name'),)).indexOf('-++-') + 4);
                                    existingData = JSON.parse(JSON.stringify(existingData).replaceAll(dado_antigo, ''));
                                    if (aba == 'Rotinas') {
                                        existingData[cad] += newData;
                                    } else if (aba == 'Chamadas') {
                                        existingData['chamadas'] += newData;
                                    } else if (aba == 'Setores') {
                                        existingData['qth'] += newData;
                                    }
                                    sessionStorage.setItem('ja_enviado' + aba, JSON.stringify(existingData));

                                }
                                docRef.set({ ...existingData })
                                    .then(() => {
                                        clearInterval(interval_envio);
                                        if (aba == 'Rotinas') {
                                            fecha_ultimo_horario(celulas);
                                        }
                                        //remove do banco local, j√° que j√° subiu pro bd
                                        const registros_locais = JSON.parse(localStorage.getItem('registros_locais') || '{}');
                                        Object.entries(registros_locais).forEach(([key]) => {
                                            if (key.includes(newData.split('-()-')[0])) {
                                                delete registros_locais[key];
                                            }
                                        });
                                        localStorage.setItem('registros_locais', JSON.stringify(registros_locais));

                                    })
                                    .catch((error) => { console.error("Erro ao atualizar o documento:", error); clearInterval(interval_envio) });

                            } else {
                                let dados = '';
                                if (aba == 'Rotinas') {
                                    dados = {
                                        'norte': '',
                                        'sul': '',
                                        'centro': '',
                                        'especializadas': ''
                                    }
                                    dados[cad] = newData;
                                } else if (aba == 'Chamadas') {
                                    dados = { 'chamadas': newData };
                                }
                                sessionStorage.setItem('ja_enviado' + aba, JSON.stringify(dados));
                                // Documento n√£o existe, apenas cria com os novos dados
                                docRef.set(dados)
                                    .then(() => {
                                        clearInterval(interval_envio);
                                        fecha_ultimo_horario(celulas);
                                        //remove do banco local, j√° que j√° subiu pro bd
                                        const registros_locais = JSON.parse(localStorage.getItem('registros_locais') || '{}');
                                        Object.entries(registros_locais).forEach(([key]) => {
                                            if (key.includes(newData.split('-()-')[0])) {
                                                delete registros_locais[key];
                                            }
                                        });
                                        localStorage.setItem('registros_locais', JSON.stringify(registros_locais));
                                    })
                                    .catch((error) => { console.error("Erro ao criar o documento:", error); clearInterval(interval_envio) });
                            }
                        });
                    }
                }
            }, 100);

        }

        function fecha_ultimo_horario(celulas) {
            let hora = new Date().toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false, // usa o formato 24h
            });
            // Filtra as rotinas da GU que ainda n√£o t√™m um hor√°rio final (td[6] vazio)
            let rotinas_da_gu = Array.from(document.querySelectorAll('tr')).filter(linha => {
                return linha.innerText.includes(celulas[1].innerText) && linha.querySelectorAll('td')[6].innerText == '';
            });

            // Certifique-se de que temos pelo menos duas rotinas
            if (rotinas_da_gu.length >= 2) {
                const penultima_rotina = rotinas_da_gu[rotinas_da_gu.length - 2];

                if (penultima_rotina) {
                    const tdFinal = penultima_rotina.querySelectorAll('td')[6];

                    // Verifica se o td[6] est√° vazio antes de atribuir a hora
                    if (tdFinal && tdFinal.innerText.trim() === '') {
                        tdFinal.innerText = hora;

                        // Chama a fun√ß√£o de envio de dados, se necess√°rio
                        enviar_dados(tdFinal);
                    } else {
                        console.error("Erro: N√£o foi poss√≠vel atualizar o hor√°rio final.");
                    }
                }
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const toggle = document.getElementById("toggle-dark-mode");

            if (localStorage.getItem("modo-escuro") === "ativado") {
                document.body.classList.add("dark-mode");
                toggle.textContent = "‚òÄÔ∏è";
            }
            if (localStorage.getItem("ordem_tabelas")) {
                document.querySelector('#rotinas_table thead').innerHTML = localStorage.getItem('ordem_tabelas').split('-()-')[0];
                document.querySelector('#chamadas_table thead').innerHTML = localStorage.getItem('ordem_tabelas').split('-()-')[1];
                document.querySelector('#equipes_table thead').innerHTML = localStorage.getItem('ordem_tabelas').split('-()-')[2];
            }

            toggle.addEventListener("click", () => {
                document.body.classList.toggle("dark-mode");
                const modoEscuroAtivo = document.body.classList.contains("dark-mode");
                localStorage.setItem("modo-escuro", modoEscuroAtivo ? "ativado" : "desativado");
                toggle.textContent = modoEscuroAtivo ? "‚òÄÔ∏è" : "üåô";
            });


            const filtro_rotinas = localStorage.getItem('filtro_rotinas');
            if (filtro_rotinas && filtro_rotinas.split('-()-')[9]) {
                document.querySelector('#rotina_data_inicial').value = filtro_rotinas.split('-()-')[0];
                document.querySelector('#rotina_data_final').value = filtro_rotinas.split('-()-')[1];
                document.querySelector('#num_periodo_relativo').value = filtro_rotinas.split('-()-')[2];
                document.querySelector('#select_tipo_periodo').value = filtro_rotinas.split('-()-')[3];
                document.querySelector('#rotina_checkbox_norte').checked = filtro_rotinas.split('-()-')[4] === 'true';
                document.querySelector('#rotina_checkbox_sul').checked = filtro_rotinas.split('-()-')[5] === 'true';
                document.querySelector('#rotina_checkbox_centro').checked = filtro_rotinas.split('-()-')[6] === 'true';
                document.querySelector('#rotina_checkbox_especializadas').checked = filtro_rotinas.split('-()-')[7] === 'true';
                document.querySelector('#num_pregistros_rotinas').value = filtro_rotinas.split('-()-')[9];
            }
            const filtro_chamadas = localStorage.getItem('filtro_chamadas');
            if (filtro_chamadas) {
                document.querySelector('#chamadas_data_inicial').value = filtro_chamadas.split('-()-')[0];
                document.querySelector('#chamadas_data_final').value = filtro_chamadas.split('-()-')[1];

            }
            const filtro_equipes = localStorage.getItem('filtro_equipes');
            if (filtro_equipes) {
                const inputs = document.querySelectorAll('#filtro_equipes input');
                const valores = filtro_equipes.split('-()-');
                for (let index = 0; index < inputs.length; index++) {
                    const input = inputs[index];
                    if (input.type == 'datetime-local') {
                        input.value = valores[index];
                    } else {
                        input.checked = valores[index] == 'true';
                    }
                }

            }
            let interval_logado = setInterval(() => {
                if (sessionStorage.getItem('usuario_logado')) {
                    if (JSON.parse(sessionStorage.getItem('usuario_logado')).credencial == '3') {
                        document.querySelector('#aba_usu√°rios').style.display = '';
                    }
                    document.querySelectorAll("#rotinas_table tbody tr,#chamadas_table tbody tr,#setores_table tbody tr").forEach(tr => {
                        tr.setAttribute('name', JSON.parse(sessionStorage.getItem('usuario_logado')).nome + '-**-' + new Date().getTime());
                    });
                    clearInterval(interval_logado);
                    //clicar no tipo de per√≠odo armazenado banco
                    if (filtro_rotinas && filtro_rotinas.split('-()-')[8]) {
                        document.querySelector(`#${filtro_rotinas.split('-()-')[8]}`).click();
                    }
                    filtrar_dados('rotinas');
                    filtrar_dados('chamadas');
                    filtrar_dados('equipes');
                    baixa_banco();
                    if (localStorage.getItem('config_abas')) {
                        Array.from(document.querySelectorAll('button[class*="tab-button"]')).filter(button => button.innerText == localStorage.getItem('config_abas'))[0].click();
                    }
                    const registros_locais = JSON.parse(localStorage.getItem('registros_locais') || '{}');
                    Object.entries(registros_locais).forEach(([key, value]) => {
                        document.querySelector(`#${key.split('--')[0]}_table tbody`).insertAdjacentHTML('afterbegin', value);
                    });
                    let selectionBox;
                    let startX, startY;

                    document.addEventListener('mousedown', (e) => {
                        if (e.button !== 0) return; // S√≥ bot√£o esquerdo
                        if (!(e.target.tagName == 'BODY' || e.target.tagName == 'HTML')) return;
                        e.preventDefault();

                        startX = e.pageX;
                        startY = e.pageY;

                        selectionBox = document.createElement('div');
                        selectionBox.className = 'selection-box';
                        selectionBox.style.left = `${startX}px`;
                        selectionBox.style.top = `${startY}px`;
                        document.body.appendChild(selectionBox);
                        document.addEventListener('mousemove', onMouseMove);
                        document.addEventListener('mouseup', onMouseUp);
                    });

                    function onMouseMove(e) {
                        if (!selectionBox) return;
                        document.body.style.userSelect = 'none';
                        const currentX = e.pageX;
                        const currentY = e.pageY;

                        const width = Math.abs(currentX - startX);
                        const height = Math.abs(currentY - startY);

                        selectionBox.style.width = `${width}px`;
                        selectionBox.style.height = `${height}px`;

                        selectionBox.style.left = `${Math.min(currentX, startX)}px`;
                        selectionBox.style.top = `${Math.min(currentY, startY)}px`;
                        const items = document.querySelectorAll('.div_tabela_registros tbody tr');
                        const boxRect = selectionBox.getBoundingClientRect();

                        items.forEach(item => {
                            const itemRect = item.getBoundingClientRect();
                            const isInside = !(
                                itemRect.right < boxRect.left ||
                                itemRect.left > boxRect.right ||
                                itemRect.bottom < boxRect.top ||
                                itemRect.top > boxRect.bottom
                            );

                            if (item?.querySelector('input[type=checkbox]')) {
                                if (isInside) {
                                    item.querySelector('input[type=checkbox]').checked = true;
                                } else {
                                    item.querySelector('input[type=checkbox]').checked = false;
                                }
                            }

                        });
                    }

                    function onMouseUp(e) {
                        if (!selectionBox) return;
                        // Verificar colis√£o com itens
                        document.body.style.userSelect = '';

                        selectionBox.remove();
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    }
                }
            }, 100);
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', () => {
                    // Remove classes anteriores
                    th.closest('table').querySelectorAll('th').forEach(header => {
                        header.classList.remove('sorted-asc', 'sorted-desc');
                    });
                    const index = Array.from(th.closest('thead').querySelectorAll('th')).indexOf(th);
                    let linhas = Array.from(th.closest('table').querySelectorAll('tbody tr')).map((l) => l.querySelectorAll('td')[index].innerText + '-&&-' + l.outerHTML + '-&&-' + l.querySelector('input[type=checkbox]')?.checked);
                    if (th.closest('table').getAttribute('id') != 'equipes_table') {
                        linhas.pop();
                    }

                    if (!th.getAttribute('asc')) {
                        th.closest('table').querySelectorAll('th').forEach(header => {
                            header.classList.remove('sorted-asc', 'sorted-desc');
                            header.removeAttribute('desc');
                            header.removeAttribute('asc');
                        });
                        th.classList.add('sorted-asc');
                        th.setAttribute('asc', 'a');
                        linhas.sort().reverse();
                    } else {
                        th.closest('table').querySelectorAll('th').forEach(header => {
                            header.classList.remove('sorted-asc', 'sorted-desc');
                            header.removeAttribute('desc');
                            header.removeAttribute('asc');
                        });
                        th.classList.add('sorted-desc');
                        th.setAttribute('desc', 'a');
                        linhas.sort();
                    }
                    if (th.closest('table').getAttribute('id') != 'equipes_table') {
                        th.closest('table').querySelector('tbody').innerHTML = th.closest('table').querySelector('tbody tr:last-child').outerHTML;
                        linhas.forEach(l => {
                            th.closest('table').querySelector('tbody tr:last-child').insertAdjacentHTML('beforebegin', l.split('-&&-')[1]);
                            if (th.closest('table').querySelector('tbody tr:last-child').previousElementSibling.querySelector('input[type=checkbox]')) {
                                th.closest('table').querySelector('tbody tr:last-child').previousElementSibling.querySelector('input[type=checkbox]').checked = l.split('-&&-')[2] == 'true';
                            }
                        });
                    } else {
                        th.closest('table').querySelector('tbody').innerHTML = '';
                        linhas = linhas.map((l) => l.split('-&&-')[1]).forEach(l => {
                            th.closest('table').querySelector('tbody').insertAdjacentHTML('afterbegin', l);
                        });
                    }

                    localStorage.setItem('ordem_tabelas', document.querySelector('#rotinas_table thead').innerHTML + '-()-' + document.querySelector('#chamadas_table thead').innerHTML + '-()-' + document.querySelector('#equipes_table thead').innerHTML);
                });

                document.querySelectorAll('.dropdown').forEach(item => {
                    const button = item.querySelector('.dropdown-button');

                    button.addEventListener('click', () => {
                        item.classList.toggle('show');
                    });

                    // Fecha o dropdown se clicar fora
                    window.addEventListener('click', (e) => {
                        if (!item.contains(e.target)) {
                            item.classList.remove('show');
                        }
                    });
                });


            });

            if (sessionStorage.getItem('usuario_logado')) {
                document.querySelector('#login').style.display = 'none';
                document.querySelector('#programa').style.display = '';
            }

            document.querySelectorAll('#seleciona_periodo_absoluto input:not([type=radio]),#seleciona_periodo_relativo input:not([type=radio]),#seleciona_periodo_relativo select').forEach(input => {
                input.addEventListener('click', function () {
                    input.parentNode.parentNode.querySelector('input[type=radio]').click();
                })
            })

            //se o usuario setar periodo relativo na aba Rotinas, ele vai ficar monitorando e excluindo localmente os registros fora do per√≠odo
            setInterval(() => {
                const linhas = document.querySelectorAll('#rotinas_table tbody tr');
                if (document.querySelector("#seleciona_periodo_relativo > input[type=radio]").checked) {

                    if (document.querySelector("#select_tipo_periodo").value != '0') {
                        const data_inicial_filtro = new Date();
                        const minutos = parseInt(document.querySelector("#num_periodo_relativo").value) * parseInt(document.querySelector("#select_tipo_periodo").value)
                        data_inicial_filtro.setMinutes(data_inicial_filtro.getMinutes() - minutos);
                        linhas.forEach(linha => {
                            let data_hora_registro = linha.querySelectorAll('td')[5].innerText.split(/\/|, |:/);
                            if (data_hora_registro.length == 5) {
                                data_hora_registro = new Date(parseInt(data_hora_registro[2]), parseInt(data_hora_registro[1]) - 1, parseInt(data_hora_registro[0]), parseInt(data_hora_registro[3]), parseInt(data_hora_registro[4]));
                                if (!isNaN(data_hora_registro) && (data_hora_registro < data_inicial_filtro || data_hora_registro > new Date()) && !linha.contains(document.activeElement)) {
                                    linha.remove();
                                }
                            }
                        })
                    }
                }
                let ja_corrigidos = '';
                const ultimos_registros = parseInt(document.querySelector("#num_pregistros_rotinas").value);
                linhas.forEach(linha => {
                    if (!linha) return;
                    let qra = linha.querySelectorAll('td')[1].innerText.trim()
                    if (!ja_corrigidos.includes(qra)) {
                        const celulas = Array.from(linhas).filter(l => l.querySelectorAll('td')[1].innerText.trim() == qra);
                        for (let index = 0; index < celulas.length - ultimos_registros; index++) {
                            celulas[index].style.display = 'none';
                        }
                        ja_corrigidos += qra;
                    }
                })


            }, 1000);



        });

        function ultimos_registros(tabela) {
            document.querySelectorAll(`#${tabela}_table tbody tr`).forEach(linha => {
                linha.style.display = '';
            });
            guardar_filtro('rotinas');

        }

        function blockEvent(e) {
            e.preventDefault();
        }

        function setInputsDisabled(element, disabled) {

            if (disabled) {
                // Para input number, usamos readonly que bloqueia edi√ß√£o mas permite foco e clique
                element.setAttribute('readonly', 'readonly');

                // Para select, n√£o existe readonly, ent√£o bloqueamos via evento
                element.disabled = false; // para poder ouvir eventos
                element.addEventListener('mousedown', blockEvent);
                element.addEventListener('keydown', blockEvent);
            } else {
                element.removeAttribute('readonly');
                element.disabled = false;
                element.removeEventListener('mousedown', blockEvent);
                element.removeEventListener('keydown', blockEvent);
            }
        }

        function filtro_areas(area) {
            const linhas = document.querySelectorAll('#equipes_table tbody tr');
            const areas = ['200 Cruzeiro', '300 Partenon', '400 Leste', '500 Restinga', '600 Norte', '700 Eixo Baltazar', '800 Pinheiro', '900 Sul', '1000 Romu', '1100 Patam', '1200 Centro', 'Comando'];
            const primeiro_char = ['2', '3', '4', '5', '6', '7', '8', '9', 'R', 'P', 'C', 'A'];
            if (area.value == 'Todas') {
                for (let index = 1; index < area.parentNode.parentNode.querySelectorAll('input').length; index++) {
                    area.parentNode.parentNode.querySelectorAll('input')[index].checked = area.checked;
                    area.parentNode.parentNode.querySelectorAll('input')[index].dispatchEvent(new Event('input'));
                }
            } else {
                linhas.forEach(linha => {
                    if (linha.querySelectorAll('td')[2].innerText.trim().startsWith(primeiro_char[areas.indexOf(area.value)]) || linha.querySelectorAll('td')[2].innerText.trim().startsWith(area.value.split(' ')[0])) {
                        linha.style.display = area.checked ? '' : 'none';
                    }
                })
                if (area.checked == false) {
                    area.parentNode.parentNode.querySelector('input').checked = false;
                } else if (area.parentNode.parentNode.querySelectorAll('input:checked').length == 12) {
                    area.parentNode.parentNode.querySelector('input').checked = true;
                }

            }
            guardar_filtro('equipes');
        }

        function guardar_filtro(filtro) {
            if (filtro == 'rotinas') {
                localStorage.setItem('filtro_rotinas', `${document.querySelector('#rotina_data_inicial').value}-()-${document.querySelector('#rotina_data_final').value}-()-${document.querySelector('#num_periodo_relativo').value}-()-${document.querySelector('#select_tipo_periodo').value}-()-${document.querySelector('#rotina_checkbox_norte').checked}-()-${document.querySelector('#rotina_checkbox_sul').checked}-()-${document.querySelector('#rotina_checkbox_centro').checked}-()-${document.querySelector('#rotina_checkbox_especializadas').checked}-()-${document.querySelector('#filtro input:not([type=radio]):not([readonly])').parentNode.parentNode.getAttribute('id')}-()-${document.querySelector('#num_pregistros_rotinas').value}`);
            } else if (filtro == 'chamadas') {
                localStorage.setItem('filtro_chamadas', `${document.querySelector('#chamadas_data_inicial').value}-()-${document.querySelector('#chamadas_data_final').value}`);
            } else {
                let valores = [];
                document.querySelectorAll('#filtro_equipes input').forEach(input => {
                    if (input.type == 'datetime-local') {
                        valores.push(input.value);
                    } else {
                        valores.push(input.checked);
                    }
                })
                localStorage.setItem('filtro_equipes', valores.join('-()-'));
            }
        }

        function filtro_tipo_equipes(tipo) {
            const linhas = document.querySelectorAll('#equipes_table tbody tr');
            if (tipo.value == 'Todas') {
                for (let index = 1; index < tipo.parentNode.parentNode.querySelectorAll('input').length; index++) {
                    tipo.parentNode.parentNode.querySelectorAll('input')[index].checked = tipo.checked;
                    tipo.parentNode.parentNode.querySelectorAll('input')[index].dispatchEvent(new Event('input'));
                }
            } else {
                linhas.forEach(linha => {
                    if ((tipo.value == 'Pessoas' && (linha.querySelectorAll('td')[2].innerText.trim().includes('Dia') || linha.querySelectorAll('td')[2].innerText.trim().includes('Noite'))) || tipo.value == 'Equipamentos' && !linha.querySelectorAll('td')[2].innerText.trim().includes('Dia') && !linha.querySelectorAll('td')[2].innerText.trim().includes('Noite')) {
                        linha.style.display = tipo.checked ? '' : 'none';
                    }
                })
                if (tipo.checked == false) {
                    tipo.parentNode.parentNode.querySelector('input').checked = false;
                } else if (tipo.parentNode.parentNode.querySelectorAll('input:checked').length == 2) {
                    tipo.parentNode.parentNode.querySelector('input').checked = true;
                }

            }
            guardar_filtro('equipes');
        }

        function seleciona_periodo(tipo_periodo) {
            document.querySelectorAll('#seleciona_periodo_absoluto input:not([type=radio]),#seleciona_periodo_relativo input:not([type=radio]),#seleciona_periodo_relativo select').forEach(input => {
                setInputsDisabled(input, true);
            });
            tipo_periodo.parentNode.querySelectorAll('input:not([type=radio]),select').forEach(input => {
                setInputsDisabled(input, false);
            });
            tipo_periodo.parentNode.querySelector('input:not([type=radio])').dispatchEvent(new Event('input', { bubbles: true }));
        }

        function empenhar_gu(demanda) {
            let dados = demanda.closest('tr').querySelectorAll('td');
            let id = JSON.parse(sessionStorage.getItem('usuario_logado')).nome + '-**-' + new Date().getTime();
            let endereco = dados[5].innerText.trim();
            let qths = localStorage.getItem('qth').split('-++-')
            let qth = 'DEM ';
            let tipo_local = 'Resid√™ncia';
            qths.forEach(item => {
                if (endereco == item.split('-()-')[1]?.trim()) {
                    qth += item.split('-()-')[1].trim();
                    endereco = item.split('-()-')[4].trim();
                    tipo_local = item.split('-()-')[2].trim();
                }
            });
            let narrativa = dados[3].innerText;
            let natureza = dados[4].innerText;
            let telefone = dados[2].innerText;
            let solicitante = dados[1].innerText;
            if (qth == 'DEM ') {
                qth += natureza;
            }
            let dados_demanda = `${qth}-()-${tipo_local}-()-${narrativa}-()-${endereco}-()-${natureza}-()-_QRA_-()-_QTR_INICIAL_-()-_QRU_-()-_QTR_FINAL_-()-${telefone}-()-${solicitante}-++-`;
            document.querySelector('button[class="tab-button"]').click();
            let linha = criar_linha('rotinas', [id, qth, tipo_local, narrativa, endereco, natureza, '', new Date().toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false, // usa o formato 24h
            }), '', '', telefone, solicitante]);
            document.querySelector('#rotinas_table tbody tr:last-child').insertAdjacentHTML('beforeBegin', linha);
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: "smooth"
            });
            document.querySelector('#rotinas_table tbody tr:last-child').previousElementSibling.querySelectorAll('td')[1].focus();
        }


        function turno_atual(button) {
            const hora = new Date().getHours();
            let seletores_data = button.parentNode.parentNode.querySelectorAll('input[type*=date]');
            if (hora > 18 || hora < 6) {

                seletores_data[0].value = new Date(new Date().setHours(15, 30, 0)).toISOString().slice(0, -5);
                seletores_data[0].dispatchEvent(new Event('input', { bubbles: true }));

                const data_final = new Date();
                data_final.setDate(data_final.getDate() + 1);
                seletores_data[1].value = new Date(data_final.setHours(3, 30, 0)).toISOString().slice(0, -5);
                seletores_data[1].dispatchEvent(new Event('input', { bubbles: true }));
            } else {
                seletores_data[0].value = new Date(new Date().setHours(3, 30, 0)).toISOString().slice(0, -5);
                seletores_data[0].dispatchEvent(new Event('input', { bubbles: true }));
                seletores_data[1].value = new Date(new Date().setHours(15, 30, 0)).toISOString().slice(0, -5);
                seletores_data[1].dispatchEvent(new Event('input', { bubbles: true }));
            }
        }

        async function excluir_linha(button, todos) {
            const row = button.closest('tr');
            const celulas = row.querySelectorAll('td');
            const aba = document.querySelector('button.tab-button.ativo').innerText;
            const id = row.getAttribute('name');

            let confirmacao = todos || confirm(`Voc√™ realmente deseja excluir o registro:\n${celulas[1]?.innerText} - ${celulas[2]?.innerText} - ${celulas[3]?.innerText} - ${celulas[4]?.innerText}?`);
            if (!confirmacao) return;

            const removerLinhaVisual = () => {
                row.remove();
                const registros_locais = JSON.parse(localStorage.getItem('registros_locais') || '{}');
                Object.entries(registros_locais).forEach(([key]) => {
                    if (key.includes(row.getAttribute('name'))) {
                        delete registros_locais[key];
                    }
                });
                localStorage.setItem('registros_locais', JSON.stringify(registros_locais));
            }

            const atualizarFirestore = async (colecao, docId) => {
                const docRef = db.collection(colecao).doc(docId);
                const snapshot = await docRef.get();
                if (!snapshot.exists) return removerLinhaVisual();

                const dados = snapshot.data();
                const dadosStr = JSON.stringify(dados);

                if (!dadosStr.includes(id)) return removerLinhaVisual();

                const inicio = dadosStr.indexOf(id);
                const fim = dadosStr.indexOf('-++-', inicio);
                const dadoAntigo = dadosStr.substring(inicio, fim + 4);
                const novoStr = dadosStr.replace(dadoAntigo, '');

                try {
                    const dadosAtualizados = JSON.parse(novoStr);
                    await docRef.set(dadosAtualizados);
                    sessionStorage.setItem('ja_enviado' + aba, JSON.stringify(dadosAtualizados));

                    removerLinhaVisual();
                } catch (e) {
                    console.error("Erro ao atualizar Firestore:", e);
                }
            };

            if (aba === 'Rotinas' && celulas[5]?.innerText.includes('/')) {
                const [dia, mes, anoRaw] = celulas[5].innerText.split('/');
                const ano = anoRaw.split(',')[0];
                const data = new Date(ano, parseInt(mes) - 1, parseInt(dia));
                await atualizarFirestore(aba.toLowerCase(), data.toISOString());
            } else if (aba === 'Chamadas') {
                const timestamp = parseInt(id.split('-**-')[1]);
                const data = new Date(new Date(timestamp).toDateString()); // normaliza para YYYY-MM-DD
                await atualizarFirestore(aba.toLowerCase(), data.toISOString());
            } else if (aba === 'Setores') {
                await atualizarFirestore('dados_fixos', 'qth');
            } else {
                celulas[1]?.focus();
                celulas[1]?.blur();
                removerLinhaVisual();
            }
        }

        function selecionar_tudo(checkbox) {
            checkbox.closest('table').querySelectorAll('input[type="checkbox"]:not([onchange])').forEach(check => {
                check.checked = checkbox.checked;
            });
        }
        function copiar_selecionados() {
            let texto = '';
            let copiados = localStorage.getItem('copiados') || '';
            document.querySelectorAll('#rotinas_table tbody tr').forEach(tr => {
                if (tr.querySelector('input[type=checkbox]').checked == true) {
                    tr.querySelector('svg').setAttribute('class', 'copiar_clicado');
                    copiados += tr.getAttribute('name');
                    texto += copiar_dados(tr.querySelector('svg'), true);
                    tr.querySelector('input[type=checkbox]').checked = false;
                }
            })
            localStorage.setItem('copiados', copiados);
            navigator.clipboard.writeText(texto);
            const msg = document.createElement('div');
            msg.textContent = 'Copiado';
            msg.style.position = 'absolute';
            msg.style.top = '0';
            msg.style.left = '100%'; // ou ajuste como preferir
            msg.style.background = '#007bff';
            msg.style.color = '#fff';
            msg.style.padding = '4px 8px';
            msg.style.borderRadius = '10px';
            msg.style.zIndex = '9999'; // ‚Üê garante que fique por cima

            // Garante que o SVG possa conter o elemento
            const wrapper = document.querySelector('#rotinas_table thead span');
            wrapper.style.position = 'relative';
            wrapper.appendChild(msg);

            setTimeout(() => msg.remove(), 1000);


        }

        async function excluir_selecionados() {
            const confirmar = confirm('Deseja realmente excluir todos esses registros?');
            if (!confirmar) return;

            const aba = document.querySelector('button.tab-button.ativo').innerText.toLowerCase();
            const tabela = document.querySelector(`#${aba}_table`);
            if (!tabela) return;

            const linhasSelecionadas = Array.from(tabela.querySelectorAll('tbody tr')).filter(tr => {
                const checkbox = tr.querySelector('input[type=checkbox]');
                if (aba === 'rotinas') {
                    const data_inicial = tr.querySelectorAll('td')[5].innerText;
                    return checkbox && checkbox.checked && data_inicial != '';
                } else if (aba === 'chamadas') {
                    const qtr = tr.querySelectorAll('td')[9].innerText;
                    return checkbox && checkbox.checked && qtr != '';
                }


            });

            if (!linhasSelecionadas.length) return;

            // Agrupar por docId
            const grupos = {};

            for (const tr of linhasSelecionadas) {
                const id = tr.getAttribute('name');
                const celulas = tr.querySelectorAll('td');
                let docId = '';

                if (aba === 'rotinas' && celulas[5]?.innerText.includes('/')) {
                    const [d, m, yRaw] = celulas[5].innerText.split('/');
                    const y = yRaw.split(',')[0];
                    docId = new Date(y, parseInt(m) - 1, parseInt(d)).toISOString();
                } else if (aba === 'chamadas') {
                    const timestamp = parseInt(id);
                    docId = new Date(new Date(timestamp).toDateString()).toISOString();
                } else {
                    tr.remove(); // Para 'setores' ou outros
                    continue;
                }

                if (!grupos[docId]) grupos[docId] = [];
                grupos[docId].push({ id, tr });
            }

            // Para cada docId, fazer exclus√£o consolidada
            const promises = Object.entries(grupos).map(async ([docId, registros]) => {
                const docRef = db.collection(aba).doc(docId);
                const snapshot = await docRef.get();

                if (!snapshot.exists) {
                    registros.forEach(r => r.tr.remove());
                    return;
                }

                let dados = JSON.stringify(snapshot.data());

                registros.forEach(({ id }) => {
                    const inicio = dados.indexOf(id);
                    const fim = dados.indexOf('-++-', inicio);
                    if (inicio >= 0 && fim > inicio) {
                        const dadoAntigo = dados.substring(inicio, fim + 4);
                        dados = dados.replace(dadoAntigo, '');
                    }
                });

                try {
                    const atualizado = JSON.parse(dados);
                    await docRef.set(atualizado);
                    registros.forEach(r => r.tr.remove());
                } catch (err) {
                    console.error(`Erro ao excluir no doc ${docId}:`, err);
                }
            });

            await Promise.all(promises);
            document.querySelector(`#${aba}_table label[class="checkbox-wrapper"]`).click();
        }

        function abrir_legislacao_modal() {
            const modal = document.querySelector('#modal');
            modal.style.display = 'block';

        }

        function fechar_modal() {
            document.querySelector('#modal').style.display = 'none';
        }

        function abrir_filtro_avancado(tabela) {
            tabela.closest('tr').nextElementSibling.style.display = tabela.closest('tr').nextElementSibling.style.display == 'none' ? '' : 'none';
            tabela.innerHTML = tabela.innerHTML == '‚Üê' ? '‚Üì' : '‚Üê';
        }
    </script>
</body>

</html>